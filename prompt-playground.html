<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”„ë¡¬í”„íŠ¸ í…ŒìŠ¤íŠ¸ í”Œë ˆì´ê·¸ë¼ìš´ë“œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.95;
        }

        .content {
            padding: 30px;
        }

        /* íƒ­ ìŠ¤íƒ€ì¼ */
        .tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 30px;
            gap: 10px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 15px 25px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: #666;
            border-radius: 8px 8px 0 0;
            transition: all 0.3s;
        }

        .tab:hover {
            background: #e9ecef;
            color: #333;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .section {
            margin-bottom: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
        }

        .section h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* ë²„ì „ í—¤ë” */
        .version-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 2px solid #667eea;
        }

        .version-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .version-badge {
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .version-badge.default {
            background: #28a745;
        }

        .version-name {
            font-weight: 600;
            color: #333;
        }

        .version-date {
            color: #666;
            font-size: 0.9rem;
        }

        /* í¼ ê·¸ë£¹ */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 1rem;
        }

        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            font-family: 'Monaco', 'Courier New', monospace;
            resize: vertical;
            min-height: 150px;
            transition: border-color 0.2s;
        }

        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea.prompt-editor {
            min-height: 250px;
            background: #2d2d2d;
            color: #f8f8f2;
        }

        .form-group input[type="text"],
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            margin-right: 10px;
            margin-top: 10px;
            transition: transform 0.2s, box-shadow 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-small {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-right: 8px;
            margin-bottom: 8px;
            transition: background 0.2s;
        }

        .btn-small:hover {
            background: #5a6268;
        }

        .btn-small.btn-danger {
            background: #dc3545;
        }

        .btn-small.btn-danger:hover {
            background: #c82333;
        }

        .btn-small.btn-success {
            background: #28a745;
        }

        .btn-small.btn-success:hover {
            background: #218838;
        }

        /* ë²„ì „ íˆìŠ¤í† ë¦¬ */
        .version-history {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            max-height: 500px;
            overflow-y: auto;
            display: none;
        }

        .version-history.show {
            display: block;
        }

        .version-history h4 {
            margin-bottom: 15px;
            color: #333;
        }

        .version-item {
            padding: 15px;
            margin-bottom: 10px;
            background: white;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            transition: border-color 0.2s;
        }

        .version-item:hover {
            border-color: #667eea;
        }

        .version-item.current {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .version-item.default-version {
            border-color: #28a745;
            background: #f0fff4;
        }

        .version-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .version-item-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .version-status {
            color: #667eea;
            font-weight: bold;
            margin-left: 10px;
        }

        .version-meta {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .version-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        /* ì‘ë‹µ ì˜ì—­ */
        .response {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            max-height: 600px;
            overflow-y: auto;
            animation: fadeIn 0.3s;
        }

        .response.success {
            background: #d4edda;
            border: 2px solid #c3e6cb;
            color: #155724;
        }

        .response.error {
            background: #f8d7da;
            border: 2px solid #f5c6cb;
            color: #721c24;
        }

        .result-section {
            margin: 15px 0;
            padding: 12px;
            background: rgba(255,255,255,0.5);
            border-radius: 5px;
        }

        .result-section strong {
            display: block;
            margin-bottom: 8px;
            font-size: 1.05rem;
        }

        .result-section p {
            margin: 5px 0;
            line-height: 1.6;
        }

        .result-section ul {
            margin: 5px 0;
            padding-left: 25px;
        }

        .result-section li {
            margin: 5px 0;
            line-height: 1.5;
        }

        .meta-info {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(0,0,0,0.1);
            text-align: right;
            opacity: 0.8;
        }

        /* ë¡œë”© */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        /* ìƒ˜í”Œ ë²„íŠ¼ */
        .sample-buttons {
            margin: 15px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        /* Backup ì„¹ì…˜ */
        .backup-section {
            padding: 20px;
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .backup-section h4 {
            margin-bottom: 15px;
            color: #856404;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .content {
                padding: 20px;
            }
            
            .section {
                padding: 20px;
            }

            .tabs {
                gap: 5px;
            }

            .tab {
                padding: 12px 16px;
                font-size: 0.9rem;
            }

            .version-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }

        /* ì¶”ê°€: ìºë¦­í„° ì¹´ìš´í„° */
        .char-counter {
            text-align: right;
            color: #666;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        /* WebRTC í…ŒìŠ¤íŠ¸ ì „ìš© ìŠ¤íƒ€ì¼ */
        .connection-status-box {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            margin: 20px 0;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .status-icon {
            font-size: 2rem;
        }

        .status-text {
            color: #333;
        }

        .audio-status-box {
            display: flex;
            gap: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            margin: 20px 0;
        }

        .audio-item {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
        }

        .audio-icon {
            font-size: 2.5rem;
        }

        .audio-item strong {
            display: block;
            color: #333;
            margin-bottom: 5px;
        }

        .audio-item p {
            color: #666;
            margin: 0;
            font-size: 0.95rem;
        }

        .chat-log {
            margin-top: 30px;
        }

        .chat-log h4 {
            margin-bottom: 15px;
            color: #333;
        }

        .chat-messages {
            max-height: 400px;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }

        .chat-message {
            padding: 12px 0;
            border-bottom: 1px solid #e0e0e0;
            line-height: 1.6;
        }

        .chat-message:last-child {
            border-bottom: none;
        }

        .chat-message.user {
            color: #667eea;
        }

        .chat-message.user strong {
            color: #667eea;
        }

        .chat-message.ai {
            color: #28a745;
        }

        .chat-message.ai strong {
            color: #28a745;
        }

        .chat-message.system {
            color: #6c757d;
            font-style: italic;
        }

        .chat-message.system strong {
            color: #6c757d;
        }

        .info-box {
            padding: 20px;
            background: #e7f3ff;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .info-box h4 {
            margin-bottom: 15px;
            color: #333;
        }

        .info-box table {
            font-size: 0.9rem;
        }

        .info-box table th {
            font-weight: 600;
            text-align: left;
        }

        /* ê³ ê¸‰ ì„¤ì • ìŠ¤íƒ€ì¼ */
        .tooltip-icon {
            display: inline-block;
            width: 18px;
            height: 18px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 18px;
            font-size: 0.75rem;
            cursor: help;
            margin-left: 5px;
        }

        .tooltip-icon:hover {
            background: #764ba2;
        }

        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            opacity: 0.9;
            transition: opacity 0.2s;
        }

        input[type="range"]:hover {
            opacity: 1;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            border: none;
        }

        #realtime-advanced-settings h4 {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        #advanced-settings-toggle {
            width: 100%;
            text-align: left;
            font-size: 1rem;
            padding: 12px 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¨ í”„ë¡¬í”„íŠ¸ í…ŒìŠ¤íŠ¸ í”Œë ˆì´ê·¸ë¼ìš´ë“œ</h1>
            <p>LLM í”„ë¡¬í”„íŠ¸ë¥¼ ìˆ˜ì •í•˜ê³  ì‹¤ì‹œê°„ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”</p>
        </div>

        <div class="content">
            <!-- ë°±ì—… ì„¹ì…˜ -->
            <div class="backup-section">
                <h4>ğŸ’¾ ë°ì´í„° ë°±ì—… & ê³µìœ </h4>
                <button class="btn-small" onclick="exportAllVersions()">
                    ğŸ“¥ ëª¨ë“  ë²„ì „ ë‹¤ìš´ë¡œë“œ (JSON)
                </button>
                <button class="btn-small" onclick="document.getElementById('import-file').click()">
                    ğŸ“¤ ë²„ì „ ë¶ˆëŸ¬ì˜¤ê¸°
                </button>
                <input type="file" id="import-file" accept=".json" style="display:none" 
                       onchange="importVersions(this.files[0])">
                
                <p style="font-size: 0.9rem; color: #856404; margin-top: 10px;">
                    ğŸ’¡ íŒŒì¼ë¡œ ì €ì¥í•˜ë©´ ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ë‚˜ ë™ë£Œì™€ ê³µìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤! ì •ê¸°ì ìœ¼ë¡œ ë°±ì—…í•˜ì„¸ìš”.
                </p>
                <p id="storage-usage" style="font-size: 0.9rem; color: #856404; margin-top: 5px;"></p>
            </div>

            <!-- íƒ­ ë©”ë‰´ -->
            <div class="tabs">
                <button class="tab active" onclick="switchTab('organize-diary')">ì¼ê¸° ì •ë¦¬</button>
                <button class="tab" onclick="switchTab('context-extract')">ì»¨í…ìŠ¤íŠ¸ ì¶”ì¶œ</button>
                <button class="tab" onclick="switchTab('tts')">ìŒì„± í•©ì„± (TTS)</button>
                <button class="tab" onclick="switchTab('realtime')">ì‹¤ì‹œê°„ ëŒ€í™”</button>
            </div>

            <!-- íƒ­ 1: ì¼ê¸° ì •ë¦¬ -->
            <div id="tab-organize-diary" class="tab-content active">
                <!-- í…ŒìŠ¤íŠ¸ ì…ë ¥ ì„¹ì…˜ -->
                <div class="section">
                    <h3>ğŸ’¬ í…ŒìŠ¤íŠ¸ ì…ë ¥</h3>
                    <div class="form-group">
                        <label for="diary-input">ìŒì„± ì „ì‚¬ í…ìŠ¤íŠ¸ ì…ë ¥:</label>
                        <textarea id="diary-input" placeholder="ì˜¤ëŠ˜ ìˆì—ˆë˜ ì¼ë“¤ì„ ììœ ë¡­ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”...&#10;&#10;ì˜ˆ: ì˜¤ëŠ˜ì€ ì•„ì¹¨ ì¼ì° ì¼ì–´ë‚˜ì„œ 30ë¶„ ì¡°ê¹…ì„ í–ˆì–´ìš”. ë‚ ì”¨ê°€ ë„ˆë¬´ ì¢‹ì•„ì„œ ê¸°ë¶„ì´ ìƒì¾Œí–ˆìŠµë‹ˆë‹¤..."></textarea>
                        <div class="char-counter" id="diary-input-counter">0ì</div>
                    </div>

                    <div class="sample-buttons">
                        <strong style="display: block; width: 100%; margin-bottom: 10px; color: #555;">ìƒ˜í”Œ ë°ì´í„°:</strong>
                        <button class="btn-small" onclick="loadSample('organize-diary', 1)">ğŸ“ ìƒ˜í”Œ 1: ì¼ìƒ ì´ì•¼ê¸°</button>
                        <button class="btn-small" onclick="loadSample('organize-diary', 2)">ğŸ’ª ìƒ˜í”Œ 2: ìš´ë™ ì¼ê¸°</button>
                        <button class="btn-small" onclick="loadSample('organize-diary', 3)">ğŸ˜Š ìƒ˜í”Œ 3: ì§§ì€ ì¼ê¸°</button>
                        <button class="btn-small" onclick="clearInput('organize-diary')">ğŸ—‘ï¸ ì§€ìš°ê¸°</button>
                    </div>
                </div>

                <!-- í”„ë¡¬í”„íŠ¸ í¸ì§‘ ì„¹ì…˜ -->
                <div class="section">
                    <h3>ğŸ§  í”„ë¡¬í”„íŠ¸ í¸ì§‘</h3>
                    
                    <!-- ë²„ì „ í—¤ë” -->
                    <div class="version-header">
                        <div class="version-info">
                            <span class="version-badge" id="diary-version-badge">v0</span>
                            <span class="version-name" id="diary-version-name">Default</span>
                            <span class="version-date" id="diary-version-date"></span>
                        </div>
                        <button class="btn-small btn-success" onclick="toggleVersionHistory('organize-diary')">
                            ğŸ“œ íˆìŠ¤í† ë¦¬ ë³´ê¸°
                        </button>
                    </div>

                    <div class="form-group">
                        <label for="diary-prompt">System Prompt:</label>
                        <textarea id="diary-prompt" class="prompt-editor" placeholder="í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                        <div class="char-counter" id="diary-prompt-counter">0ì</div>
                    </div>

                    <button class="btn-small" onclick="resetToDefault('organize-diary')">ğŸ”„ Defaultë¡œ ë˜ëŒë¦¬ê¸°</button>
                    <button class="btn-small btn-success" onclick="saveAsNewVersion('organize-diary')">ğŸ’¾ ìƒˆ ë²„ì „ìœ¼ë¡œ ì €ì¥</button>

                    <!-- ë²„ì „ íˆìŠ¤í† ë¦¬ -->
                    <div class="version-history" id="diary-version-history"></div>
                </div>

                <!-- í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë²„íŠ¼ -->
                <button class="btn" onclick="testPrompt('organize-diary')" id="diary-test-btn">
                    <span>ğŸš€ ì´ í”„ë¡¬í”„íŠ¸ë¡œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</span>
                    <span class="loading hidden" id="diary-loading"></span>
                </button>

                <!-- ê²°ê³¼ ì„¹ì…˜ -->
                <div class="response hidden" id="diary-response"></div>
            </div>

            <!-- íƒ­ 2: ì»¨í…ìŠ¤íŠ¸ ì¶”ì¶œ (placeholder) -->
            <div id="tab-context-extract" class="tab-content">
                <div class="section">
                    <h3>ğŸ’¬ í…ŒìŠ¤íŠ¸ ì…ë ¥</h3>
                    <div class="form-group">
                        <label for="context-input">ëŒ€í™” ë‚´ìš©:</label>
                        <textarea id="context-input" placeholder="ì‚¬ìš©ì: ì˜¤ëŠ˜ ìš´ë™ì„ í–ˆì–´ìš”&#10;AI: ì¢‹ì€ ìŠµê´€ì´ë„¤ìš”! ì–´ë–¤ ìš´ë™ì„ í•˜ì…¨ë‚˜ìš”?&#10;ì‚¬ìš©ì: ì¡°ê¹… 30ë¶„ í–ˆìŠµë‹ˆë‹¤"></textarea>
                        <div class="char-counter" id="context-input-counter">0ì</div>
                    </div>
                </div>

                <div class="section">
                    <h3>ğŸ§  í”„ë¡¬í”„íŠ¸ í¸ì§‘</h3>
                    
                    <div class="version-header">
                        <div class="version-info">
                            <span class="version-badge" id="context-version-badge">v0</span>
                            <span class="version-name" id="context-version-name">Default</span>
                            <span class="version-date" id="context-version-date"></span>
                        </div>
                        <button class="btn-small btn-success" onclick="toggleVersionHistory('context-extract')">
                            ğŸ“œ íˆìŠ¤í† ë¦¬ ë³´ê¸°
                        </button>
                    </div>

                    <div class="form-group">
                        <label for="context-prompt">Custom Prompt:</label>
                        <textarea id="context-prompt" class="prompt-editor"></textarea>
                        <div class="char-counter" id="context-prompt-counter">0ì</div>
                    </div>

                    <button class="btn-small" onclick="resetToDefault('context-extract')">ğŸ”„ Defaultë¡œ ë˜ëŒë¦¬ê¸°</button>
                    <button class="btn-small btn-success" onclick="saveAsNewVersion('context-extract')">ğŸ’¾ ìƒˆ ë²„ì „ìœ¼ë¡œ ì €ì¥</button>

                    <div class="version-history" id="context-version-history"></div>
                </div>

                <button class="btn" onclick="testPrompt('context-extract')" id="context-test-btn">
                    <span>ğŸš€ ì´ í”„ë¡¬í”„íŠ¸ë¡œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</span>
                    <span class="loading hidden" id="context-loading"></span>
                </button>

                <div class="response hidden" id="context-response"></div>
            </div>

            <!-- íƒ­ 3: TTS (placeholder) -->
            <div id="tab-tts" class="tab-content">
                <div class="section">
                    <h3>ğŸ’¬ í…ŒìŠ¤íŠ¸ ì…ë ¥</h3>
                    <div class="form-group">
                        <label for="tts-input">í…ìŠ¤íŠ¸ ì…ë ¥:</label>
                        <textarea id="tts-input" placeholder="ì•ˆë…•í•˜ì„¸ìš”! ë§Œë‚˜ì„œ ë°˜ê°‘ìŠµë‹ˆë‹¤." style="min-height: 100px;"></textarea>
                        <div class="char-counter" id="tts-input-counter">0ì</div>
                    </div>

                    <div class="form-group">
                        <label for="tts-voice">ìŒì„± ì„ íƒ:</label>
                        <select id="tts-voice">
                            <option value="alloy">Alloy (ì¤‘ì„±ì )</option>
                            <option value="echo">Echo (ë‚¨ì„±)</option>
                            <option value="fable">Fable (ì˜êµ­ ë‚¨ì„±)</option>
                            <option value="onyx">Onyx (ê¹Šì€ ë‚¨ì„±)</option>
                            <option value="nova">Nova (ì—¬ì„±)</option>
                            <option value="shimmer">Shimmer (ë°ì€ ì—¬ì„±)</option>
                        </select>
                    </div>
                </div>

                <div class="section">
                    <h3>ğŸ§  Instructions í¸ì§‘</h3>
                    
                    <div class="version-header">
                        <div class="version-info">
                            <span class="version-badge" id="tts-version-badge">v0</span>
                            <span class="version-name" id="tts-version-name">Default</span>
                            <span class="version-date" id="tts-version-date"></span>
                        </div>
                        <button class="btn-small btn-success" onclick="toggleVersionHistory('tts')">
                            ğŸ“œ íˆìŠ¤í† ë¦¬ ë³´ê¸°
                        </button>
                    </div>

                    <div class="form-group">
                        <label for="tts-instructions">TTS Instructions:</label>
                        <textarea id="tts-instructions" class="prompt-editor" style="min-height: 120px;"></textarea>
                        <div class="char-counter" id="tts-instructions-counter">0ì</div>
                    </div>

                    <button class="btn-small" onclick="resetToDefault('tts')">ğŸ”„ Defaultë¡œ ë˜ëŒë¦¬ê¸°</button>
                    <button class="btn-small btn-success" onclick="saveAsNewVersion('tts')">ğŸ’¾ ìƒˆ ë²„ì „ìœ¼ë¡œ ì €ì¥</button>

                    <div class="version-history" id="tts-version-history"></div>
                </div>

                <button class="btn" onclick="testPrompt('tts')" id="tts-test-btn">
                    <span>ğŸš€ ìŒì„± ìƒì„±í•˜ê¸°</span>
                    <span class="loading hidden" id="tts-loading"></span>
                </button>

                <div class="response hidden" id="tts-response"></div>
            </div>

            <!-- íƒ­ 4: Realtime (placeholder) -->
            <div id="tab-realtime" class="tab-content">
                <div class="section">
                    <h3>âš™ï¸ ì„¸ì…˜ ì„¤ì •</h3>
                    
                    <div class="form-group">
                        <label for="realtime-model">ëª¨ë¸ ì„ íƒ:</label>
                        <select id="realtime-model">
                            <option value="gpt-4o-realtime-preview-2024-12-17">GPT-4o Realtime (2024-12-17) - ê¶Œì¥</option>
                            <option value="gpt-4o-mini-realtime-preview">GPT-4o Mini Realtime</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="realtime-voice">ìŒì„± ì„ íƒ:</label>
                        <select id="realtime-voice">
                            <option value="alloy">Alloy (ì¤‘ì„±ì )</option>
                            <option value="echo">Echo (ë‚¨ì„±)</option>
                            <option value="shimmer">Shimmer (ë°ì€ ì—¬ì„±)</option>
                            <option value="ash">Ash</option>
                            <option value="ballad">Ballad</option>
                            <option value="coral">Coral</option>
                            <option value="sage">Sage</option>
                            <option value="verse">Verse</option>
                        </select>
                    </div>

                    <!-- í”„ë¦¬ì…‹ ì„ íƒ -->
                    <div class="form-group">
                        <label for="realtime-preset">ğŸ¯ ê³ ê¸‰ ì„¤ì • í”„ë¦¬ì…‹:</label>
                        <select id="realtime-preset" onchange="handlePresetChange(this.value)">
                            <!-- DBì—ì„œ ë™ì ìœ¼ë¡œ ë¡œë“œë¨ -->
                        </select>
                        <small style="display: block; margin-top: 5px; color: #666;">
                            ğŸ’¡ í”„ë¦¬ì…‹ì„ ì„ íƒí•˜ë©´ ê³ ê¸‰ ì„¤ì •ì´ ìë™ìœ¼ë¡œ ì ìš©ë©ë‹ˆë‹¤. í”„ë¡¬í”„íŠ¸ì™€ëŠ” ë…ë¦½ì ìœ¼ë¡œ ê´€ë¦¬ë©ë‹ˆë‹¤.
                        </small>
                        <button class="btn-small" onclick="togglePresetHistory()" style="margin-top: 10px;">
                            ğŸ“œ í”„ë¦¬ì…‹ íˆìŠ¤í† ë¦¬ ë³´ê¸°
                        </button>
                        <div class="preset-history" id="realtime-preset-history"></div>
                    </div>

                    <!-- ê³ ê¸‰ ì„¤ì • ì•„ì½”ë””ì–¸ -->
                    <div style="margin-top: 20px;">
                        <button class="btn-small" onclick="toggleAdvancedSettings()" id="advanced-settings-toggle">
                            â–¶ ê³ ê¸‰ ì„¤ì • (Advanced Settings)
                        </button>
                    </div>

                    <div id="realtime-advanced-settings" style="display: none; margin-top: 15px; padding: 20px; background: #f0f4ff; border-radius: 10px; border: 2px solid #667eea;">
                        
                        <!-- ìŒì„± í’ˆì§ˆ ì„¤ì • -->
                        <h4 style="color: #667eea; margin-bottom: 15px;">ğŸµ ìŒì„± í’ˆì§ˆ</h4>
                        
                        <div class="form-group">
                            <label for="realtime-temperature">
                                Temperature (ìŒì„± ë‹¤ì–‘ì„±)
                                <span class="tooltip-icon" title="AI ìŒì„±ì˜ ì°½ì˜ì„±ì„ ì¡°ì ˆí•©ë‹ˆë‹¤. ë‚®ì„ìˆ˜ë¡ ì¼ê´€ì ì´ê³  ì˜ˆì¸¡ ê°€ëŠ¥í•˜ë©°, ë†’ì„ìˆ˜ë¡ ë‹¤ì–‘í•˜ê³  ìì—°ìŠ¤ëŸ½ìŠµë‹ˆë‹¤.">â„¹ï¸</span>
                            </label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="range" id="realtime-temperature" min="0.6" max="1.2" step="0.1" value="0.8" 
                                       oninput="updateSliderValue('realtime-temperature')" 
                                       style="flex: 1;">
                                <span id="realtime-temperature-value" style="min-width: 50px; font-weight: bold;">0.8</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 0.85rem; color: #666; margin-top: 5px;">
                                <span>ì¼ê´€ì </span>
                                <span>ì°½ì˜ì </span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="realtime-speed">
                                Speed (ë§í•˜ê¸° ì†ë„)
                                <span class="tooltip-icon" title="AIì˜ ë§í•˜ê¸° ì†ë„ë¥¼ ì¡°ì ˆí•©ë‹ˆë‹¤. 0.25x ~ 4.0x ë²”ìœ„ì—ì„œ ì„¤ì • ê°€ëŠ¥í•©ë‹ˆë‹¤.">â„¹ï¸</span>
                            </label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="range" id="realtime-speed" min="0.5" max="2.0" step="0.1" value="1.0" 
                                       oninput="updateSliderValue('realtime-speed')" 
                                       style="flex: 1;">
                                <span id="realtime-speed-value" style="min-width: 50px; font-weight: bold;">1.0x</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 0.85rem; color: #666; margin-top: 5px;">
                                <span>ëŠë¦¼ (0.5x)</span>
                                <span>ë¹ ë¦„ (2.0x)</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="realtime-noise-reduction">
                                <input type="checkbox" id="realtime-noise-reduction" style="width: auto; margin-right: 8px;">
                                Noise Reduction (ë…¸ì´ì¦ˆ ê°ì†Œ)
                                <span class="tooltip-icon" title="ë§ˆì´í¬ ì…ë ¥ì—ì„œ ë°°ê²½ ì†ŒìŒì„ ì œê±°í•©ë‹ˆë‹¤. ì†ŒìŒì´ ë§ì€ í™˜ê²½ì—ì„œ ìœ ìš©í•©ë‹ˆë‹¤.">â„¹ï¸</span>
                            </label>
                        </div>

                        <hr style="margin: 25px 0; border: none; border-top: 1px solid #ddd;">

                        <!-- ìŒì„± ê°ì§€ (VAD) ì„¤ì • -->
                        <h4 style="color: #667eea; margin-bottom: 15px;">ğŸ¤ ìŒì„± ê°ì§€ (VAD)</h4>

                        <div class="form-group">
                            <label for="realtime-threshold">
                                Threshold (ê°ì§€ ë¯¼ê°ë„)
                                <span class="tooltip-icon" title="ìŒì„±ì„ ê°ì§€í•˜ëŠ” ë¯¼ê°ë„ì…ë‹ˆë‹¤. ë‚®ì„ìˆ˜ë¡ ì‘ì€ ì†Œë¦¬ë„ ê°ì§€í•˜ë©°, ë†’ì„ìˆ˜ë¡ í° ì†Œë¦¬ë§Œ ê°ì§€í•©ë‹ˆë‹¤.">â„¹ï¸</span>
                            </label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="range" id="realtime-threshold" min="0.0" max="1.0" step="0.1" value="0.5" 
                                       oninput="updateSliderValue('realtime-threshold')" 
                                       style="flex: 1;">
                                <span id="realtime-threshold-value" style="min-width: 50px; font-weight: bold;">0.5</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 0.85rem; color: #666; margin-top: 5px;">
                                <span>ë¯¼ê° (0.0)</span>
                                <span>ë‘”ê° (1.0)</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="realtime-silence-duration">
                                Silence Duration (ì¹¨ë¬µ ì¸ì‹ ì‹œê°„)
                                <span class="tooltip-icon" title="ë§ì„ ë©ˆì¶˜ í›„ ëª‡ ë°€ë¦¬ì´ˆ ë™ì•ˆ ì¹¨ë¬µì´ ì§€ì†ë˜ì–´ì•¼ ë°œí™”ê°€ ëë‚¬ë‹¤ê³  íŒë‹¨í• ì§€ ì„¤ì •í•©ë‹ˆë‹¤.">â„¹ï¸</span>
                            </label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="range" id="realtime-silence-duration" min="0" max="1000" step="50" value="200" 
                                       oninput="updateSliderValue('realtime-silence-duration')" 
                                       style="flex: 1;">
                                <span id="realtime-silence-duration-value" style="min-width: 60px; font-weight: bold;">200ms</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 0.85rem; color: #666; margin-top: 5px;">
                                <span>ì¦‰ì‹œ (0ms)</span>
                                <span>ì—¬ìœ ìˆê²Œ (1000ms)</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="realtime-prefix-padding">
                                Prefix Padding (ë°œí™” ì‹œì‘ ë²„í¼)
                                <span class="tooltip-icon" title="ìŒì„± ê°ì§€ ì‹œ ë°œí™” ì‹œì‘ ë¶€ë¶„ì´ ì˜ë¦¬ì§€ ì•Šë„ë¡ ì•ë¶€ë¶„ì— ì¶”ê°€í•  ë²„í¼ ì‹œê°„ì…ë‹ˆë‹¤.">â„¹ï¸</span>
                            </label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="range" id="realtime-prefix-padding" min="0" max="1000" step="50" value="300" 
                                       oninput="updateSliderValue('realtime-prefix-padding')" 
                                       style="flex: 1;">
                                <span id="realtime-prefix-padding-value" style="min-width: 60px; font-weight: bold;">300ms</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 0.85rem; color: #666; margin-top: 5px;">
                                <span>ì—†ìŒ (0ms)</span>
                                <span>ë„‰ë„‰í•˜ê²Œ (1000ms)</span>
                            </div>
                        </div>

                        <hr style="margin: 25px 0; border: none; border-top: 1px solid #ddd;">

                        <!-- AI ì‘ë‹µ ì„¤ì • -->
                        <h4 style="color: #667eea; margin-bottom: 15px;">ğŸ¤– AI ì‘ë‹µ</h4>

                        <div class="form-group">
                            <label for="realtime-max-tokens">
                                Max Output Tokens (ìµœëŒ€ ì¶œë ¥ í† í°)
                                <span class="tooltip-icon" title="AIê°€ í•œ ë²ˆì— ìƒì„±í•  ìˆ˜ ìˆëŠ” ìµœëŒ€ í† í° ìˆ˜ì…ë‹ˆë‹¤. 'inf'ëŠ” ë¬´ì œí•œì„ ì˜ë¯¸í•©ë‹ˆë‹¤.">â„¹ï¸</span>
                            </label>
                            <input type="text" id="realtime-max-tokens" value="inf" placeholder="inf ë˜ëŠ” ìˆ«ì (ì˜ˆ: 4096)"
                                   style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px;">
                            <small style="display: block; margin-top: 5px; color: #666;">
                                ğŸ’¡ 'inf'ëŠ” ë¬´ì œí•œ, ë˜ëŠ” 1~4096 ì‚¬ì´ì˜ ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”.
                            </small>
                        </div>

                        <div class="form-group">
                            <label for="realtime-truncation">
                                Truncation (ëŒ€í™” íˆìŠ¤í† ë¦¬ ê´€ë¦¬)
                                <span class="tooltip-icon" title="ëŒ€í™”ê°€ ê¸¸ì–´ì§ˆ ë•Œ ì´ì „ ë©”ì‹œì§€ë¥¼ ìë™ìœ¼ë¡œ ì œê±°í• ì§€ ì„¤ì •í•©ë‹ˆë‹¤.">â„¹ï¸</span>
                            </label>
                            <select id="realtime-truncation" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px;">
                                <option value="auto">Auto (ìë™ ê´€ë¦¬)</option>
                                <option value="disabled">Disabled (ë¹„í™œì„±í™”)</option>
                            </select>
                        </div>

                        <div style="margin-top: 20px; display: flex; gap: 10px;">
                            <button class="btn-small" onclick="resetAdvancedSettings()">ğŸ”„ ê¸°ë³¸ê°’ìœ¼ë¡œ ë¦¬ì…‹</button>
                            <button class="btn-small btn-success" onclick="saveAdvancedSettingsToPreset()">ğŸ’¾ ì»¤ìŠ¤í…€ í”„ë¦¬ì…‹ìœ¼ë¡œ ì €ì¥</button>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>ğŸ§  System Instructions í¸ì§‘</h3>
                    
                    <div class="version-header">
                        <div class="version-info">
                            <span class="version-badge" id="realtime-version-badge">v0</span>
                            <span class="version-name" id="realtime-version-name">Default</span>
                            <span class="version-date" id="realtime-version-date"></span>
                        </div>
                        <button class="btn-small btn-success" onclick="toggleVersionHistory('realtime')">
                            ğŸ“œ íˆìŠ¤í† ë¦¬ ë³´ê¸°
                        </button>
                    </div>

                    <div class="form-group">
                        <label for="realtime-instructions">System Instructions:</label>
                        <textarea id="realtime-instructions" class="prompt-editor"></textarea>
                        <div class="char-counter" id="realtime-instructions-counter">0ì</div>
                    </div>

                    <button class="btn-small" onclick="resetToDefault('realtime')">ğŸ”„ Defaultë¡œ ë˜ëŒë¦¬ê¸°</button>
                    <button class="btn-small btn-success" onclick="saveAsNewVersion('realtime')">ğŸ’¾ ìƒˆ ë²„ì „ìœ¼ë¡œ ì €ì¥</button>

                    <div class="version-history" id="realtime-version-history"></div>
                </div>

                <button class="btn" onclick="testPrompt('realtime')" id="realtime-test-btn">
                    <span>ğŸ” í† í° ë°œê¸‰í•˜ê¸°</span>
                    <span class="loading hidden" id="realtime-loading"></span>
                </button>

                <div class="response hidden" id="realtime-response"></div>

                <!-- WebRTC ì—°ê²° ì„¹ì…˜ -->
                <div id="realtime-webrtc-section" style="display: none; margin-top: 30px;">
                    <div class="section">
                        <h3>ğŸŒ WebRTC P2P ì—°ê²°</h3>
                        <p class="description">
                            ìœ„ì—ì„œ ë°œê¸‰ë°›ì€ Ephemeral Tokenìœ¼ë¡œ OpenAIì™€ ì§ì ‘ P2P ì—°ê²°í•˜ì—¬ ì‹¤ì‹œê°„ ìŒì„± ëŒ€í™”ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.
                        </p>
                        
                        <!-- í† í° ì…ë ¥ í•„ë“œ -->
                        <div class="form-group">
                            <label for="realtime-token-input">ğŸ”‘ Ephemeral Token (ek_ë¡œ ì‹œì‘):</label>
                            <textarea id="realtime-token-input" 
                                      placeholder="í† í° ë°œê¸‰ í›„ ìë™ìœ¼ë¡œ ì…ë ¥ë©ë‹ˆë‹¤..."
                                      style="min-height: 80px; font-family: monospace; font-size: 0.9rem;"
                                      readonly></textarea>
                            <small style="color: #666; display: block; margin-top: 5px;">
                                â„¹ï¸ í† í° ë°œê¸‰ í›„ ìë™ ì…ë ¥ë©ë‹ˆë‹¤. í•„ìš”ì‹œ ë‹¤ë¥¸ í† í°ì„ ì§ì ‘ ë¶™ì—¬ë„£ê¸°í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
                            </small>
                        </div>

                        <div class="connection-status-box">
                            <div class="status-indicator">
                                <span class="status-icon" id="realtime-webrtc-status-icon">ğŸ”´</span>
                                <span class="status-text" id="realtime-webrtc-status-text">ì—°ê²° ì•ˆ ë¨</span>
                            </div>
                            <div id="realtime-webrtc-connection-info" style="display: none; margin-top: 15px;">
                                <p><strong>ì„¸ì…˜ ID:</strong> <span id="realtime-webrtc-session-id">-</span></p>
                                <p><strong>ì—°ê²° íƒ€ì…:</strong> <span style="color: #667eea; font-weight: 600;">WebRTC P2P (Ephemeral Token)</span></p>
                                <p><strong>í”„ë¡œí† ì½œ:</strong> RTCPeerConnection + DataChannel</p>
                                <p><strong>ì¸ì¦:</strong> <code id="realtime-token-preview">-</code></p>
                            </div>
                        </div>

                        <!-- ì—°ê²° ë²„íŠ¼ -->
                        <button class="btn" id="realtime-connect-webrtc-btn" onclick="connectRealtimeWebRTC()">
                            <span>ğŸš€ ì´ í† í°ìœ¼ë¡œ WebRTC P2P ì—°ê²° ì‹œì‘</span>
                            <span class="loading hidden" id="realtime-connect-loading"></span>
                        </button>
                        <button class="btn" id="realtime-disconnect-webrtc-btn" onclick="disconnectRealtimeWebRTC()" style="display: none; background: #dc3545;">
                            <span>â¸ï¸ ì—°ê²° ì¢…ë£Œ</span>
                        </button>
                    </div>

                    <!-- ìŒì„± ì±„íŒ… ì„¹ì…˜ -->
                    <div id="realtime-voice-chat-section" style="display: none;">
                        <div class="section">
                            <h3>ğŸ¤ ì‹¤ì‹œê°„ ìŒì„± ëŒ€í™”</h3>
                            <p class="description">
                                WebRTC ì—°ê²°ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ì»¤ìŠ¤í…€ í”„ë¡¬í”„íŠ¸ë¡œ AIì™€ ì‹¤ì‹œê°„ ëŒ€í™”ë¥¼ ë‚˜ëˆ ë³´ì„¸ìš”.
                            </p>

                            <!-- ì˜¤ë””ì˜¤ ìƒíƒœ -->
                            <div class="audio-status-box">
                                <div class="audio-item">
                                    <span class="audio-icon">ğŸ¤</span>
                                    <div>
                                        <strong>ë§ˆì´í¬</strong>
                                        <p id="realtime-mic-status">â¸ï¸ ë¹„í™œì„±</p>
                                    </div>
                                </div>
                                <div class="audio-item">
                                    <span class="audio-icon">ğŸ”Š</span>
                                    <div>
                                        <strong>ìŠ¤í”¼ì»¤</strong>
                                        <p id="realtime-speaker-status">â¸ï¸ ë¹„í™œì„±</p>
                                    </div>
                                </div>
                            </div>

                            <!-- ìŒì„± ì»¨íŠ¸ë¡¤ -->
                            <div style="margin: 20px 0;">
                                <button class="btn" id="realtime-start-voice-btn" onclick="startRealtimeVoiceChat()">
                                    <span>ğŸ¤ ë§í•˜ê¸° ì‹œì‘</span>
                                </button>
                                <button class="btn" id="realtime-stop-voice-btn" onclick="stopRealtimeVoiceChat()" style="display: none; background: #dc3545;">
                                    <span>â¹ï¸ ë§í•˜ê¸° ì¤‘ì§€</span>
                                </button>
                            </div>

                            <!-- ëŒ€í™” ë¡œê·¸ -->
                            <div class="chat-log">
                                <h4>ğŸ’¬ ëŒ€í™” ë¡œê·¸</h4>
                                <div class="chat-messages" id="realtime-chat-messages">
                                    <div class="chat-message system">
                                        <strong>ğŸ“¢ ì‹œìŠ¤í…œ:</strong> WebRTC ì—°ê²°ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. "ë§í•˜ê¸° ì‹œì‘" ë²„íŠ¼ì„ ëˆŒëŸ¬ ëŒ€í™”ë¥¼ ì‹œì‘í•˜ì„¸ìš”!
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // ì „ì—­ ë³€ìˆ˜ ë° ìƒìˆ˜
        // ============================================
        const API_BASE_URL = window.location.origin;
        const STORAGE_KEY = 'promptPlayground';
        
        // Default í”„ë¡¬í”„íŠ¸ (ë°±ì—”ë“œì™€ ë™ì¼í•˜ê²Œ ìœ ì§€)
        const DEFAULT_PROMPTS = {
            'organize-diary': `ë‹¹ì‹ ì€ ì¹œê·¼í•˜ê³  ë”°ëœ»í•œ ì¼ê¸° ì‘ì„± ë„ìš°ë¯¸ì…ë‹ˆë‹¤. 
ì‚¬ìš©ìê°€ ë§í•œ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ êµ¬ì¡°í™”ëœ ì¼ê¸° ìš”ì•½ì„ ìƒì„±í•´ì£¼ì„¸ìš”.

ê·œì¹™:
1. í•œêµ­ì–´ë¡œ ì‘ì„±í•˜ì„¸ìš”
2. 1ì¸ì¹­ ì‹œì ì„ ìœ ì§€í•˜ì„¸ìš” (ë‚˜ëŠ”, ë‚´ê°€ ë“±)
3. ê°ì •ê³¼ ëŠë‚Œì„ í’ë¶€í•˜ê²Œ í‘œí˜„í•˜ì„¸ìš”
4. ê° ì¹´í…Œê³ ë¦¬ì— í•´ë‹¹í•˜ëŠ” ë‚´ìš©ì´ ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´ë¡œ ë°˜í™˜í•˜ì„¸ìš”
5. ê° í•­ëª©ì€ ê°„ê²°í•˜ê²Œ 2-4ë‹¨ì–´ë¡œ í‘œí˜„í•˜ì„¸ìš”
6. oneLinerëŠ” ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ ëŒ€í‘œí•˜ëŠ” í•œ ë¬¸ì¥ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”
7. fullDiaryëŠ” ì „ì²´ ë‚´ìš©ì„ ìì—°ìŠ¤ëŸ½ê²Œ 3-5ë¬¸ì¥ìœ¼ë¡œ ì •ë¦¬í•˜ì„¸ìš”`,

            'context-extract': `ë‹¤ìŒ ëŒ€í™” ë‚´ìš©ì„ ë¶„ì„í•˜ì—¬ ì£¼ìš” ì»¨í…ìŠ¤íŠ¸ë¥¼ ì¶”ì¶œí•´ì£¼ì„¸ìš”:
1. ëŒ€í™”ì˜ ì£¼ìš” ì£¼ì œ
2. ì‚¬ìš©ìì˜ ì˜ë„ë‚˜ ëª©ì 
3. ì¤‘ìš”í•œ ì •ë³´ë‚˜ í‚¤ì›Œë“œ
4. ê°ì • ìƒíƒœë‚˜ í†¤
5. ëŒ€í™”ì˜ íë¦„ ìš”ì•½

ê²°ê³¼ëŠ” ê°„ê²°í•˜ê²Œ ë¶ˆë¦¿ í¬ì¸íŠ¸ í˜•ì‹ìœ¼ë¡œ ì •ë¦¬í•´ì£¼ì„¸ìš”.`,

            'tts': 'ì¹œê·¼í•˜ê³  ë°ì€ í†¤ìœ¼ë¡œ ë§í•´ì£¼ì„¸ìš”',

            'realtime': 'ë‹¹ì‹ ì€ ì¹œê·¼í•˜ê³  ë”°ëœ»í•œ ì¼ê¸° ì‘ì„± ë„ìš°ë¯¸ì…ë‹ˆë‹¤. ì‚¬ìš©ìì˜ í•˜ë£¨ ì´ì•¼ê¸°ë¥¼ ê²½ì²­í•˜ê³  ê³µê°í•˜ë©° ëŒ€í™”ë¥¼ ì´ì–´ê°€ì„¸ìš”. ìì—°ìŠ¤ëŸ½ê²Œ ì§ˆë¬¸í•˜ê³  ì‚¬ìš©ìê°€ ë” ë§ì€ ì´ì•¼ê¸°ë¥¼ í•  ìˆ˜ ìˆë„ë¡ ê²©ë ¤í•´ì£¼ì„¸ìš”.'
        };

        // ìƒ˜í”Œ ë°ì´í„°
        const SAMPLE_DATA = {
            'organize-diary': {
                1: "ì˜¤ëŠ˜ì€ ì•„ì¹¨ ì¼ì° ì¼ì–´ë‚˜ì„œ 30ë¶„ ì¡°ê¹…ì„ í–ˆì–´ìš”. ë‚ ì”¨ê°€ ë„ˆë¬´ ì¢‹ì•„ì„œ ê¸°ë¶„ì´ ìƒì¾Œí–ˆìŠµë‹ˆë‹¤. ì ì‹¬ì—ëŠ” íŒ€ íšŒì˜ê°€ ìˆì—ˆëŠ”ë° ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ ì•„ì´ë””ì–´ë¥¼ ë°œí‘œí–ˆì–´ìš”. ë™ë£Œë“¤ì´ ê¸ì •ì ìœ¼ë¡œ ë°˜ì‘í•´ì¤˜ì„œ ë¿Œë“¯í–ˆìŠµë‹ˆë‹¤. ì €ë…ì—ëŠ” ì¹œêµ¬ì™€ ë§›ìˆëŠ” ì €ë…ì„ ë¨¹ìœ¼ë©´ì„œ ì˜¤ëœë§Œì— ìˆ˜ë‹¤ë¥¼ ë–¨ì—ˆì–´ìš”. ì •ë§ ì•Œì°¬ í•˜ë£¨ì˜€ìŠµë‹ˆë‹¤.",
                2: "ì˜¤ëŠ˜ ë“œë””ì–´ ìš´ë™ì„ ì‹œì‘í–ˆë‹¤! í—¬ìŠ¤ì¥ì— ë“±ë¡í•˜ê³  PT ì²« ìˆ˜ì—…ì„ ë°›ì•˜ëŠ”ë° ìƒê°ë³´ë‹¤ í˜ë“¤ì—ˆë‹¤. í•˜ì§€ë§Œ íŠ¸ë ˆì´ë„ˆë‹˜ì´ ì¹œì ˆí•˜ê²Œ ê°€ë¥´ì³ì£¼ì…”ì„œ ì¢‹ì•˜ë‹¤. ìŠ¤ì¿¼íŠ¸ë‘ ë²¤ì¹˜í”„ë ˆìŠ¤ë¥¼ ë°°ì› ëŠ”ë° ìì„¸ê°€ ì •ë§ ì¤‘ìš”í•˜ë‹¤ëŠ” ê±¸ ì•Œì•˜ë‹¤. ì§‘ì— ì™€ì„œ ë‹¨ë°±ì§ˆ ì‰ì´í¬ë„ ë§Œë“¤ì–´ ë§ˆì…¨ë‹¤. 3ê°œì›” í›„ ëª©í‘œ ì²´ì¤‘ì„ ë‹¬ì„±í•˜ê³  ì‹¶ë‹¤. ë‚´ì¼ë„ ê¼­ ê°€ì•¼ì§€!",
                3: "ì˜¤ëŠ˜ ê¸°ë¶„ ì¢‹ì•˜ì–´ìš”! ë‚ ì”¨ë„ ì¢‹ê³  ì ì‹¬ë„ ë§›ìˆì—ˆì–´ìš”."
            }
        };

        // ============================================
        // ğŸ”„ API ê¸°ë°˜ í”„ë¡¬í”„íŠ¸ ê´€ë¦¬ (DB ì—°ë™)
        // ============================================
        
        // API í˜¸ì¶œ í—¬í¼ í•¨ìˆ˜ë“¤
        async function fetchPromptVersions(endpoint) {
            const response = await fetch(`${API_BASE_URL}/api/prompts/${endpoint}?action=versions`);
            return await response.json();
        }

        async function fetchCurrentPrompt(endpoint) {
            const response = await fetch(`${API_BASE_URL}/api/prompts/${endpoint}`);
            return await response.json();
        }

        async function createPromptVersion(endpoint, name, prompt, description) {
            const response = await fetch(`${API_BASE_URL}/api/prompts/${endpoint}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, prompt, description })
            });
            return await response.json();
        }

        async function switchPromptVersion(endpoint, versionId) {
            const response = await fetch(`${API_BASE_URL}/api/prompts/${endpoint}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ versionId })
            });
            return await response.json();
        }

        async function deletePromptVersion(versionId) {
            const response = await fetch(`${API_BASE_URL}/api/prompts/versions/${versionId}`, {
                method: 'DELETE'
            });
            return await response.json();
        }

        // ============================================
        // LocalStorage ê´€ë¦¬ í•¨ìˆ˜ (ë°±ì—…ìš©)
        // ============================================
        
        function initializeStorage() {
            const data = localStorage.getItem(STORAGE_KEY);
            if (!data) {
                const initialData = {
                    version: "1.0",
                    endpoints: {},
                    metadata: {
                        lastUpdated: Date.now(),
                        totalVersions: 0
                    }
                };
                
                // ê° ì—”ë“œí¬ì¸íŠ¸ì˜ v0 (Default) ìƒì„±
                for (const endpoint in DEFAULT_PROMPTS) {
                    initialData.endpoints[endpoint] = {
                        currentVersion: 'v0',
                        versions: [{
                            version: 'v0',
                            name: 'Default',
                            prompt: DEFAULT_PROMPTS[endpoint],
                            createdAt: Date.now(),
                            isDefault: true,
                            deletable: false
                        }]
                    };
                    initialData.metadata.totalVersions++;
                }
                
                localStorage.setItem(STORAGE_KEY, JSON.stringify(initialData));
                return initialData;
            }
            return JSON.parse(data);
        }

        function loadFromStorage() {
            return initializeStorage();
        }

        function saveToStorage(data) {
            try {
                data.metadata.lastUpdated = Date.now();
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                updateStorageUsage();
                return true;
            } catch (e) {
                if (e.name === 'QuotaExceededError') {
                    alert('âš ï¸ ì €ì¥ ê³µê°„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ì˜¤ë˜ëœ ë²„ì „ì„ ì‚­ì œí•´ì£¼ì„¸ìš”.');
                    return false;
                }
                throw e;
            }
        }

        function getVersions(endpoint) {
            const data = loadFromStorage();
            return data.endpoints[endpoint]?.versions || [];
        }

        function getCurrentVersion(endpoint) {
            const data = loadFromStorage();
            return data.endpoints[endpoint]?.currentVersion || 'v0';
        }

        function getCurrentVersionData(endpoint) {
            const versions = getVersions(endpoint);
            const currentVersion = getCurrentVersion(endpoint);
            return versions.find(v => v.version === currentVersion);
        }

        // ============================================
        // ë²„ì „ ê´€ë¦¬ í•¨ìˆ˜ (API ê¸°ë°˜ìœ¼ë¡œ ì˜¤ë²„ë¼ì´ë“œ)
        // ============================================

        // ê¸°ì¡´ LocalStorage í•¨ìˆ˜ë“¤ì„ API ê¸°ë°˜ìœ¼ë¡œ êµì²´
        getVersions = async function(endpoint) {
            try {
                const data = await fetchPromptVersions(endpoint);
                return data.versions || [];
            } catch (error) {
                console.error('Failed to fetch versions:', error);
                return [];
            }
        };

        getCurrentVersionData = async function(endpoint) {
            try {
                const data = await fetchCurrentPrompt(endpoint);
                return {
                    id: data.id,
                    version: data.version,
                    name: data.name,
                    prompt: data.prompt,
                    isDefault: data.isDefault,
                    deletable: !data.isDefault,
                    createdAt: data.createdAt
                };
            } catch (error) {
                console.error('Failed to fetch current version:', error);
                return null;
            }
        };

        async function refreshVersionUI(endpoint) {
            try {
                const currentVersion = await getCurrentVersionData(endpoint);
                if (currentVersion) {
                    displayPrompt(endpoint, currentVersion);
                    await updateVersionHeader(endpoint);
                }
                await renderVersionHistory(endpoint);
            } catch (error) {
                console.error('Failed to refresh UI:', error);
            }
        }

        // Default ë²„ì „ìœ¼ë¡œ ë˜ëŒë¦¬ê¸° (API ê¸°ë°˜)
        resetToDefault = async function(endpoint) {
            if (!confirm('ì •ë§ Default ë²„ì „ìœ¼ë¡œ ë˜ëŒë¦¬ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            try {
                const versions = await getVersions(endpoint);
                const defaultVersion = versions.find(v => v.isDefault);
                if (!defaultVersion) {
                    alert('âŒ Default ë²„ì „ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                const result = await switchPromptVersion(endpoint, defaultVersion.id);
                if (result.success) {
                    alert('âœ… Default ë²„ì „ìœ¼ë¡œ ë˜ëŒë ¸ìŠµë‹ˆë‹¤!');
                    await refreshVersionUI(endpoint);
                }
            } catch (error) {
                alert(`âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
            }
        };

        // ìƒˆ ë²„ì „ ì €ì¥ (API ê¸°ë°˜)
        saveAsNewVersion = async function(endpoint) {
            const currentPrompt = getPromptFromEditor(endpoint);
            if (!currentPrompt || currentPrompt.trim() === '') {
                alert('âŒ í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            const versionName = prompt('ë²„ì „ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:', `ìˆ˜ì • ë²„ì „ ${new Date().toLocaleString('ko-KR')}`);
            if (!versionName) return;
            
            try {
                // í”„ë¡¬í”„íŠ¸ë§Œ ì €ì¥ (ê³ ê¸‰ ì„¤ì •ì€ ë³„ë„ ê´€ë¦¬)
                const result = await createPromptVersion(endpoint, versionName, currentPrompt, 'ì‚¬ìš©ì ìƒì„± ë²„ì „');
                if (result.success) {
                    alert(`âœ… ${result.version.version} ë²„ì „ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!`);
                    await switchPromptVersion(endpoint, result.version.id);
                    await refreshVersionUI(endpoint);
                } else {
                    alert(`âŒ ì €ì¥ ì‹¤íŒ¨: ${result.error}`);
                }
            } catch (error) {
                alert(`âŒ ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
            }
        };

        // ë²„ì „ ì „í™˜ (API ê¸°ë°˜)
        switchToVersion = async function(endpoint, versionId) {
            try {
                const currentPrompt = getPromptFromEditor(endpoint);
                const currentVersionData = await getCurrentVersionData(endpoint);
                if (currentVersionData && currentPrompt !== currentVersionData.prompt) {
                    if (!confirm('í˜„ì¬ í¸ì§‘ ì¤‘ì¸ ë‚´ìš©ì´ ì €ì¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
                }
                const result = await switchPromptVersion(endpoint, versionId);
                if (result.success) {
                    alert(`âœ… ${result.currentVersion.version} ë²„ì „ìœ¼ë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤!`);
                    await refreshVersionUI(endpoint);
                } else {
                    alert(`âŒ ì „í™˜ ì‹¤íŒ¨: ${result.error}`);
                }
            } catch (error) {
                alert(`âŒ ì „í™˜ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
            }
        };

        // ë²„ì „ ì‚­ì œ (API ê¸°ë°˜)
        deleteVersion = async function(endpoint, versionId) {
            if (!confirm('ì •ë§ ì´ ë²„ì „ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            try {
                const result = await deletePromptVersion(versionId);
                if (result.success) {
                    alert('âœ… ë²„ì „ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
                    await refreshVersionUI(endpoint);
                } else {
                    alert(`âŒ ì‚­ì œ ì‹¤íŒ¨: ${result.error}`);
                }
            } catch (error) {
                alert(`âŒ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
            }
        };

        // ============================================
        // UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        // ============================================

        function displayPrompt(endpoint, versionData) {
            const promptEditorId = getPromptEditorId(endpoint);
            const editor = document.getElementById(promptEditorId);
            if (editor) {
                editor.value = versionData.prompt;
                updateCharCounter(promptEditorId);
            }
            
            // í”„ë¡¬í”„íŠ¸ì™€ í”„ë¦¬ì…‹ì€ ì™„ì „íˆ ë¶„ë¦¬ë˜ì–´ ê´€ë¦¬ë¨
            // ê³ ê¸‰ ì„¤ì •(í”„ë¦¬ì…‹)ì€ ë³„ë„ë¡œ ë¡œë“œë¨
            console.log('âœ… í”„ë¡¬í”„íŠ¸ ë¶ˆëŸ¬ì˜´:', versionData.version, versionData.name);
        }

        function getPromptFromEditor(endpoint) {
            const promptEditorId = getPromptEditorId(endpoint);
            const editor = document.getElementById(promptEditorId);
            return editor ? editor.value : '';
        }

        function getPromptEditorId(endpoint) {
            const mapping = {
                'organize-diary': 'diary-prompt',
                'context-extract': 'context-prompt',
                'tts': 'tts-instructions',
                'realtime': 'realtime-instructions'
            };
            return mapping[endpoint];
        }

        async function updateVersionHeader(endpoint) {
            const versionData = await getCurrentVersionData(endpoint);
            if (!versionData) return;
            
            const prefix = endpoint.replace('-', '');
            const badge = document.getElementById(`${getShortEndpoint(endpoint)}-version-badge`);
            const name = document.getElementById(`${getShortEndpoint(endpoint)}-version-name`);
            const date = document.getElementById(`${getShortEndpoint(endpoint)}-version-date`);
            
            if (badge) {
                badge.textContent = versionData.version;
                badge.className = versionData.isDefault ? 'version-badge default' : 'version-badge';
            }
            if (name) name.textContent = versionData.name;
            if (date && versionData.createdAt && !versionData.isDefault) {
                date.textContent = new Date(versionData.createdAt).toLocaleString('ko-KR');
            } else if (date) {
                date.textContent = '';
            }
        }

        function getShortEndpoint(endpoint) {
            const mapping = {
                'organize-diary': 'diary',
                'context-extract': 'context',
                'tts': 'tts',
                'realtime': 'realtime'
            };
            return mapping[endpoint];
        }

        function toggleVersionHistory(endpoint) {
            const historyId = `${getShortEndpoint(endpoint)}-version-history`;
            const history = document.getElementById(historyId);
            
            if (history.classList.contains('show')) {
                history.classList.remove('show');
            } else {
                renderVersionHistory(endpoint);
                history.classList.add('show');
            }
        }

        // ë²„ì „ íˆìŠ¤í† ë¦¬ ë Œë”ë§ (API ê¸°ë°˜)
        renderVersionHistory = async function(endpoint) {
            const historyId = `${getShortEndpoint(endpoint)}-version-history`;
            const history = document.getElementById(historyId);
            if (!history) return;
            
            try {
                const versions = await getVersions(endpoint);
                const currentVersionData = await getCurrentVersionData(endpoint);
                const currentVersion = currentVersionData?.version;
                
                let html = '<h4>ğŸ“œ ë²„ì „ íˆìŠ¤í† ë¦¬</h4>';
                
                for (let i = versions.length - 1; i >= 0; i--) {
                    const v = versions[i];
                    const isCurrent = v.version === currentVersion;
                    const itemClass = isCurrent ? 'version-item current' : 
                                     (v.isDefault ? 'version-item default-version' : 'version-item');
                    
                    // í”„ë¡¬í”„íŠ¸ ë²„ì „ë§Œ í‘œì‹œ (ê³ ê¸‰ ì„¤ì •ì€ í”„ë¦¬ì…‹ì—ì„œ ë³„ë„ ê´€ë¦¬)
                    html += `
                        <div class="${itemClass}">
                            <div class="version-item-header">
                                <div class="version-item-info">
                                    <span class="version-badge ${v.isDefault ? 'default' : ''}">${v.version}</span>
                                    <span class="version-name">${v.isDefault ? 'ğŸ”’ ' : ''}${v.name}</span>
                                    ${isCurrent ? '<span class="version-status">âœ… í˜„ì¬ ë²„ì „</span>' : ''}
                                </div>
                            </div>
                            <div class="version-meta">
                                <small>${v.isDefault ? 'ì‹œìŠ¤í…œ ê¸°ë³¸ í”„ë¡¬í”„íŠ¸' : new Date(v.createdAt).toLocaleString('ko-KR')}</small>
                            </div>
                            <div class="version-actions">
                                ${isCurrent ? 
                                    '<button class="btn-small" disabled>ì´ ë²„ì „ ë³´ê¸°</button>' : 
                                    `<button class="btn-small" onclick="switchToVersion('${endpoint}', '${v.id}')">ì´ ë²„ì „ìœ¼ë¡œ ì „í™˜</button>`
                                }
                                ${v.isDeletable && !isCurrent ? 
                                    `<button class="btn-small btn-danger" onclick="deleteVersion('${endpoint}', '${v.id}')">ì‚­ì œ</button>` :
                                    '<button class="btn-small" disabled title="Default ë²„ì „ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤">ì‚­ì œ ë¶ˆê°€</button>'
                                }
                            </div>
                        </div>
                    `;
                }
                
                history.innerHTML = html;
            } catch (error) {
                history.innerHTML = '<p style="color: red;">ë²„ì „ íˆìŠ¤í† ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>';
                console.error('Failed to render version history:', error);
            }
        };

        // ============================================
        // íƒ­ ì „í™˜
        // ============================================

        window.switchTab = async function(tabName) {
            // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // ì„ íƒí•œ íƒ­ í™œì„±í™”
            const clickedTab = document.querySelector(`button.tab[onclick*="${tabName}"]`);
            if (clickedTab) {
                clickedTab.classList.add('active');
            }
            const tabContent = document.getElementById(`tab-${tabName}`);
            if (tabContent) {
                tabContent.classList.add('active');
            }
            
            // í•´ë‹¹ íƒ­ì˜ í”„ë¡¬í”„íŠ¸ ë¡œë“œ (DBì—ì„œ)
            await loadPromptForTab(tabName);
        }

        async function loadPromptForTab(endpoint) {
            const versionData = await getCurrentVersionData(endpoint);
            if (versionData) {
                displayPrompt(endpoint, versionData);
                await updateVersionHeader(endpoint);
            }
        }

        // ============================================
        // ìƒ˜í”Œ ë°ì´í„° ë° ì…ë ¥ ê´€ë¦¬
        // ============================================

        function loadSample(endpoint, sampleNum) {
            const inputId = `${getShortEndpoint(endpoint)}-input`;
            const input = document.getElementById(inputId);
            if (input && SAMPLE_DATA[endpoint] && SAMPLE_DATA[endpoint][sampleNum]) {
                input.value = SAMPLE_DATA[endpoint][sampleNum];
                updateCharCounter(inputId);
            }
        }

        function clearInput(endpoint) {
            const inputId = `${getShortEndpoint(endpoint)}-input`;
            const input = document.getElementById(inputId);
            if (input) {
                input.value = '';
                updateCharCounter(inputId);
            }
        }

        function updateCharCounter(elementId) {
            const element = document.getElementById(elementId);
            const counter = document.getElementById(`${elementId}-counter`);
            if (element && counter) {
                counter.textContent = `${element.value.length}ì`;
            }
        }

        // ============================================
        // API í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
        // ============================================

        async function testPrompt(endpoint) {
            const inputId = `${getShortEndpoint(endpoint)}-input`;
            const loadingId = `${getShortEndpoint(endpoint)}-loading`;
            const responseId = `${getShortEndpoint(endpoint)}-response`;
            const btnId = `${getShortEndpoint(endpoint)}-test-btn`;
            
            const input = document.getElementById(inputId);
            const loading = document.getElementById(loadingId);
            const response = document.getElementById(responseId);
            const btn = document.getElementById(btnId);
            
            // ì…ë ¥ ê²€ì¦
            if (endpoint !== 'realtime' && (!input || !input.value.trim())) {
                alert('í…ŒìŠ¤íŠ¸ ì…ë ¥ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ë¡œë”© ì‹œì‘
            if (loading) loading.classList.remove('hidden');
            if (response) response.classList.add('hidden');
            if (btn) btn.disabled = true;
            
            try {
                const currentPrompt = getPromptFromEditor(endpoint);
                
                let result;
                switch (endpoint) {
                    case 'organize-diary':
                        result = await testOrganizeDiary(input.value, currentPrompt);
                        break;
                    case 'context-extract':
                        result = await testContextExtract(input.value, currentPrompt);
                        break;
                    case 'tts':
                        result = await testTTS(input.value, currentPrompt);
                        break;
                    case 'realtime':
                        result = await testRealtime(currentPrompt);
                        break;
                }
                
                displayResponse(responseId, result);
                
            } catch (error) {
                displayError(responseId, error);
            } finally {
                if (loading) loading.classList.add('hidden');
                if (btn) btn.disabled = false;
            }
        }

        async function testOrganizeDiary(text, customPrompt) {
            const startTime = Date.now();
            const response = await fetch(`${API_BASE_URL}/api/organize-diary`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text, customPrompt })
            });
            
            const data = await response.json();
            const elapsed = ((Date.now() - startTime) / 1000).toFixed(2);
            
            if (!response.ok) throw new Error(data.error || 'API í˜¸ì¶œ ì‹¤íŒ¨');
            
            return { type: 'organize-diary', data, elapsed };
        }

        async function testContextExtract(conversationText, customPrompt) {
            const startTime = Date.now();
            const response = await fetch(`${API_BASE_URL}/api/context/extract`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ conversationText, customPrompt })
            });
            
            const data = await response.json();
            const elapsed = ((Date.now() - startTime) / 1000).toFixed(2);
            
            if (!response.ok) throw new Error(data.error || 'API í˜¸ì¶œ ì‹¤íŒ¨');
            
            return { type: 'context-extract', data, elapsed };
        }

        async function testTTS(text, instructions) {
            const voice = document.getElementById('tts-voice').value;
            const startTime = Date.now();
            
            const response = await fetch(`${API_BASE_URL}/api/audio/speech`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text, voice, instructions })
            });
            
            const elapsed = ((Date.now() - startTime) / 1000).toFixed(2);
            
            if (response.ok && response.headers.get('content-type')?.includes('audio')) {
                const audioBlob = await response.blob();
                const audioUrl = URL.createObjectURL(audioBlob);
                return { type: 'tts', audioUrl, elapsed, voice, textLength: text.length };
            } else {
                const data = await response.json();
                throw new Error(data.error || 'TTS ìƒì„± ì‹¤íŒ¨');
            }
        }

        async function testRealtime(instructions) {
            const model = document.getElementById('realtime-model').value;
            const voice = document.getElementById('realtime-voice').value;
            const advancedConfig = getAdvancedConfig();  // ê³ ê¸‰ ì„¤ì • ê°€ì ¸ì˜¤ê¸°
            const startTime = Date.now();
            
            console.log('ğŸ” í† í° ë°œê¸‰ ìš”ì²­:', {
                model,
                voice,
                advancedConfig
            });
            
            const response = await fetch(`${API_BASE_URL}/api/realtime/token`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    userId: 'playground_test_user',
                    sessionConfig: { model, voice, instructions },
                    advancedConfig: advancedConfig  // ê³ ê¸‰ ì„¤ì • í¬í•¨
                })
            });
            
            const data = await response.json();
            const elapsed = ((Date.now() - startTime) / 1000).toFixed(2);
            
            if (!response.ok) throw new Error(data.error || 'Token ë°œê¸‰ ì‹¤íŒ¨');
            
            // ğŸ”‘ í† í° ì…ë ¥ í•„ë“œì— ìë™ ì…ë ¥
            document.getElementById('realtime-token-input').value = data.token;
            document.getElementById('realtime-token-input').removeAttribute('readonly');
            
            // WebRTC ì„¹ì…˜ í‘œì‹œ
            document.getElementById('realtime-webrtc-section').style.display = 'block';
            
            // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
            realtimeCurrentToken = data.token;
            realtimeSessionId = data.sessionId;
            
            return { type: 'realtime', data, elapsed };
        }

        // ============================================
        // ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜
        // ============================================

        function displayResponse(responseId, result) {
            const response = document.getElementById(responseId);
            if (!response) return;
            
            response.classList.remove('hidden', 'error');
            response.classList.add('success');
            
            let html = '<h4>âœ… í…ŒìŠ¤íŠ¸ ì„±ê³µ!</h4>';
            
            switch (result.type) {
                case 'organize-diary':
                    html += `
                        <div class="result-section">
                            <strong>ğŸ’¬ ì˜¤ëŠ˜ì˜ í•œì¤„</strong>
                            <p>${result.data.summary.oneLiner}</p>
                        </div>
                        <div class="result-section">
                            <strong>ğŸ“Œ ì£¼ìš” ì¼ìƒ</strong>
                            <ul>${result.data.summary.dailyHighlights.length > 0 ? 
                                result.data.summary.dailyHighlights.map(h => `<li>${h}</li>`).join('') : 
                                '<li style="opacity: 0.6;">ì—†ìŒ</li>'}</ul>
                        </div>
                        <div class="result-section">
                            <strong>ğŸ¯ ëª©í‘œ ì¶”ì </strong>
                            <ul>${result.data.summary.goalTracking.length > 0 ? 
                                result.data.summary.goalTracking.map(g => `<li>${g}</li>`).join('') : 
                                '<li style="opacity: 0.6;">ì—†ìŒ</li>'}</ul>
                        </div>
                        <div class="result-section">
                            <strong>ğŸ™ ê°ì‚¬í•œ ì¼</strong>
                            <ul>${result.data.summary.gratitude.length > 0 ? 
                                result.data.summary.gratitude.map(g => `<li>${g}</li>`).join('') : 
                                '<li style="opacity: 0.6;">ì—†ìŒ</li>'}</ul>
                        </div>
                        <div class="result-section">
                            <strong>ğŸ˜Š ì£¼ìš” ê°ì •</strong>
                            <ul>${result.data.summary.emotions.length > 0 ? 
                                result.data.summary.emotions.map(e => `<li>${e}</li>`).join('') : 
                                '<li style="opacity: 0.6;">ì—†ìŒ</li>'}</ul>
                        </div>
                        <div class="result-section">
                            <strong>ğŸ“– ì „ì²´ ì¼ê¸°</strong>
                            <p>${result.data.summary.fullDiary}</p>
                        </div>
                        <div class="meta-info">
                            <small>
                                ì›ë³¸ ê¸¸ì´: ${result.data.originalTextLength}ì | 
                                ì‚¬ìš© í† í°: ${result.data.tokensUsed} | 
                                í”„ë¡¬í”„íŠ¸: ${result.data._meta.promptUsed} |
                                ì‘ë‹µ ì‹œê°„: ${result.elapsed}ì´ˆ
                            </small>
                        </div>
                    `;
                    break;
                    
                case 'context-extract':
                    html += `
                        <div class="result-section">
                            <strong>ğŸ§  ì¶”ì¶œëœ ì»¨í…ìŠ¤íŠ¸</strong>
                            <p style="line-height: 1.8; white-space: pre-wrap;">${result.data.context}</p>
                        </div>
                        <div class="meta-info">
                            <small>
                                ëŒ€í™” ê¸¸ì´: ${result.data.conversationLength}ì | 
                                ì‚¬ìš© í† í°: ${result.data.tokensUsed} | 
                                ì‘ë‹µ ì‹œê°„: ${result.elapsed}ì´ˆ
                            </small>
                        </div>
                    `;
                    break;
                    
                case 'tts':
                    html += `
                        <div class="result-section">
                            <strong>ğŸ”Š ìƒì„±ëœ ìŒì„±</strong>
                            <audio controls style="width: 100%; margin-top: 10px;">
                                <source src="${result.audioUrl}" type="audio/mpeg">
                                Your browser does not support the audio element.
                            </audio>
                        </div>
                        <div class="meta-info">
                            <small>
                                ìŒì„±: ${result.voice} | 
                                í…ìŠ¤íŠ¸ ê¸¸ì´: ${result.textLength}ì | 
                                ì‘ë‹µ ì‹œê°„: ${result.elapsed}ì´ˆ
                            </small>
                        </div>
                    `;
                    break;
                    
                case 'realtime':
                    const expiresIn = Math.floor((result.data.expiresAt - Date.now() / 1000) / 60);
                    const expiresAtDate = new Date(result.data.expiresAt * 1000);
                    
                    html += `
                        <div class="result-section">
                            <strong>ğŸ”‘ Token (í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì‚¬ìš©)</strong>
                            <p style="word-break: break-all; font-family: 'Courier New', monospace; background: rgba(0,0,0,0.05); padding: 12px; border-radius: 5px; border: 1px solid #ddd;">
                                ${result.data.token}
                            </p>
                            <button class="btn-small" onclick="copyToClipboard('${result.data.token}', this)">
                                ğŸ“‹ í† í° ë³µì‚¬
                            </button>
                        </div>
                        <div class="result-section">
                            <strong>ğŸ†” ì„¸ì…˜ ID</strong>
                            <p style="font-family: monospace;">${result.data.sessionId}</p>
                        </div>
                        <div class="result-section">
                            <strong>â° ë§Œë£Œ ì‹œê°„</strong>
                            <p>ğŸ“… ${expiresAtDate.toLocaleString('ko-KR')}</p>
                            <p style="color: ${expiresIn < 5 ? '#d32f2f' : '#1976d2'}; font-weight: bold;">
                                â±ï¸ ì•½ ${expiresIn}ë¶„ í›„ ë§Œë£Œ
                            </p>
                        </div>
                        <div class="result-section">
                            <strong>âš™ï¸ ì„¸ì…˜ ì„¤ì •</strong>
                            <p><strong>ëª¨ë¸:</strong> ${result.data.config.model}</p>
                            <p><strong>ìŒì„±:</strong> ${result.data.config.voice}</p>
                        </div>
                        <div class="meta-info">
                            <small>ì‘ë‹µ ì‹œê°„: ${result.elapsed}ì´ˆ</small>
                        </div>
                    `;
                    break;
            }
            
            response.innerHTML = html;
        }

        function displayError(responseId, error) {
            const response = document.getElementById(responseId);
            if (!response) return;
            
            response.classList.remove('hidden', 'success');
            response.classList.add('error');
            response.innerHTML = `
                <h4>âŒ ì˜¤ë¥˜ ë°œìƒ</h4>
                <p><strong>ì—ëŸ¬ ë©”ì‹œì§€:</strong> ${error.message}</p>
                <pre style="margin-top: 15px; font-size: 0.85rem;">${error.stack || ''}</pre>
            `;
        }

        // ============================================
        // Export/Import í•¨ìˆ˜
        // ============================================

        function exportAllVersions() {
            const data = loadFromStorage();
            const json = JSON.stringify(data, null, 2);
            
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `prompt-playground-backup-${Date.now()}.json`;
            a.click();
            
            // ë§ˆì§€ë§‰ ë°±ì—… ì‹œê°„ ì €ì¥
            data.metadata.lastBackup = Date.now();
            saveToStorage(data);
            
            alert('âœ… ëª¨ë“  ë²„ì „ì„ íŒŒì¼ë¡œ ì €ì¥í–ˆìŠµë‹ˆë‹¤!');
        }

        function importVersions(file) {
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // ê¸°ì¡´ ë°ì´í„° í™•ì¸
                    const existingData = localStorage.getItem(STORAGE_KEY);
                    
                    if (existingData) {
                        if (confirm('ê¸°ì¡´ ë°ì´í„°ê°€ ìˆìŠµë‹ˆë‹¤. ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?\n(ì·¨ì†Œí•˜ë©´ ë³‘í•©ë©ë‹ˆë‹¤)')) {
                            // ë®ì–´ì“°ê¸°
                            localStorage.setItem(STORAGE_KEY, e.target.result);
                        } else {
                            // ë³‘í•© (ê°„ë‹¨í•œ ë²„ì „: import ìš°ì„ )
                            const existing = JSON.parse(existingData);
                            const merged = { ...existing, ...importedData };
                            localStorage.setItem(STORAGE_KEY, JSON.stringify(merged));
                        }
                    } else {
                        localStorage.setItem(STORAGE_KEY, e.target.result);
                    }
                    
                    alert('âœ… ë²„ì „ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤! í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.');
                    location.reload();
                    
                } catch (error) {
                    alert('âŒ íŒŒì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function updateStorageUsage() {
            const data = localStorage.getItem(STORAGE_KEY) || '';
            const bytes = new Blob([data]).size;
            const mb = (bytes / 1024 / 1024).toFixed(2);
            const usageEl = document.getElementById('storage-usage');
            if (usageEl) {
                usageEl.textContent = `ğŸ’¾ ì‚¬ìš© ì¤‘: ${mb} MB / 5 MB`;
            }
        }

        // ============================================
        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
        // ============================================

        function copyToClipboard(text, buttonElement) {
            navigator.clipboard.writeText(text).then(() => {
                const originalText = buttonElement.textContent;
                buttonElement.textContent = 'âœ… ë³µì‚¬ë¨!';
                buttonElement.style.background = '#28a745';
                
                setTimeout(() => {
                    buttonElement.textContent = originalText;
                    buttonElement.style.background = '';
                }, 2000);
            }).catch(err => {
                alert('ë³µì‚¬ ì‹¤íŒ¨: ' + err.message);
            });
        }

        // ============================================
        // Realtime WebRTC ì „ì—­ ë³€ìˆ˜
        // ============================================
        
        let realtimePeerConnection = null;
        let realtimeDataChannel = null;
        let realtimeLocalStream = null;
        let realtimeCurrentToken = null;
        let realtimeSessionId = null;

        // ============================================
        // Realtime WebRTC í•¨ìˆ˜ë“¤
        // ============================================

        async function connectRealtimeWebRTC() {
            const tokenInput = document.getElementById('realtime-token-input');
            const inputToken = tokenInput.value.trim();
            
            if (!inputToken) {
                alert('âŒ í† í°ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!\n\nìœ„ì—ì„œ "í† í° ë°œê¸‰í•˜ê¸°" ë²„íŠ¼ì„ ëˆŒëŸ¬ í† í°ì„ ë°œê¸‰ë°›ìœ¼ì„¸ìš”.');
                return;
            }
            
            if (!inputToken.startsWith('ek_')) {
                alert('âŒ ì˜¬ë°”ë¥¸ Ephemeral Token í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤!\n\ní† í°ì€ "ek_"ë¡œ ì‹œì‘í•´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            realtimeCurrentToken = inputToken;
            console.log('ğŸ”‘ ì‚¬ìš©í•  í† í°:', realtimeCurrentToken.substring(0, 20) + '...');
            
            updateRealtimeWebRTCStatus('connecting', 'ğŸŸ¡', 'ì—°ê²° ì¤‘...');
            
            const loadingEl = document.getElementById('realtime-connect-loading');
            const btnEl = document.getElementById('realtime-connect-webrtc-btn');
            
            loadingEl.classList.remove('hidden');
            btnEl.disabled = true;
            
            try {
                realtimePeerConnection = new RTCPeerConnection();
                console.log('ğŸ“¡ RTCPeerConnection ìƒì„±ë¨');
                
                realtimePeerConnection.addEventListener('connectionstatechange', () => {
                    const state = realtimePeerConnection.connectionState;
                    console.log('ğŸ”„ Connection state:', state);
                    
                    if (state === 'connected') {
                        updateRealtimeWebRTCStatus('connected', 'ğŸŸ¢', 'ì—°ê²°ë¨ (WebRTC P2P)');
                        showRealtimeVoiceChatSection();
                    } else if (state === 'disconnected' || state === 'failed') {
                        updateRealtimeWebRTCStatus('disconnected', 'ğŸ”´', 'ì—°ê²° ëŠê¹€');
                    } else if (state === 'connecting') {
                        updateRealtimeWebRTCStatus('connecting', 'ğŸŸ¡', 'ì—°ê²° ì¤‘...');
                    }
                });
                
                realtimePeerConnection.addEventListener('track', (event) => {
                    console.log('ğŸ”Š ì›ê²© ì˜¤ë””ì˜¤ íŠ¸ë™ ìˆ˜ì‹ :', event.track);
                    const audioElement = document.createElement('audio');
                    audioElement.srcObject = event.streams[0];
                    audioElement.autoplay = true;
                    document.body.appendChild(audioElement);
                    updateRealtimeSpeakerStatus('âœ… í™œì„±í™” (AI ìŒì„± ì¬ìƒ ì¤‘)');
                });
                
                try {
                    realtimeLocalStream = await navigator.mediaDevices.getUserMedia({ 
                        audio: {
                            echoCancellation: true,
                            noiseSuppression: true,
                            autoGainControl: true
                        } 
                    });
                    
                    realtimeLocalStream.getTracks().forEach(track => {
                        realtimePeerConnection.addTrack(track, realtimeLocalStream);
                    });
                    
                    updateRealtimeMicStatus('âœ… í™œì„±í™” (ë§ˆì´í¬ ì¤€ë¹„ ì™„ë£Œ)');
                    console.log('ğŸ¤ ë§ˆì´í¬ ìŠ¤íŠ¸ë¦¼ íšë“ ì™„ë£Œ');
                } catch (micError) {
                    console.warn('âš ï¸ ë§ˆì´í¬ ì ‘ê·¼ ì‹¤íŒ¨:', micError);
                    updateRealtimeMicStatus('âš ï¸ ê¶Œí•œ ê±°ë¶€ë¨');
                }
                
                realtimeDataChannel = realtimePeerConnection.createDataChannel('oai-events');
                
                realtimeDataChannel.addEventListener('open', () => {
                    console.log('âœ… DataChannel ì—´ë¦¼');
                    addRealtimeChatMessage('system', 'DataChannelì´ ì—´ë ¸ìŠµë‹ˆë‹¤. ì–‘ë°©í–¥ í†µì‹  ì¤€ë¹„ ì™„ë£Œ!');
                    
                    // ì„¸ì…˜ ë ˆë²¨ ì„¤ì • ì—…ë°ì´íŠ¸ (truncation, modalities ë“±)
                    const advancedConfig = getAdvancedConfig();
                    realtimeDataChannel.send(JSON.stringify({
                        type: 'session.update',
                        session: {
                            truncation: advancedConfig.truncation,
                            max_output_tokens: advancedConfig.max_output_tokens === 'inf' ? null : parseInt(advancedConfig.max_output_tokens)
                        }
                    }));
                    console.log('âš™ï¸ ì„¸ì…˜ ì„¤ì • ì—…ë°ì´íŠ¸:', {
                        truncation: advancedConfig.truncation,
                        max_output_tokens: advancedConfig.max_output_tokens
                    });
                });
                
                realtimeDataChannel.addEventListener('message', (event) => {
                    console.log('ğŸ“¥ ë©”ì‹œì§€ ìˆ˜ì‹ :', event.data);
                    handleRealtimeWebRTCMessage(event.data);
                });
                
                const offer = await realtimePeerConnection.createOffer();
                await realtimePeerConnection.setLocalDescription(offer);
                console.log('ğŸ“¤ SDP Offer ìƒì„±');
                
                const response = await fetch('https://api.openai.com/v1/realtime/calls', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${realtimeCurrentToken}`,
                        'Content-Type': 'application/sdp',
                    },
                    body: offer.sdp,
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`OpenAI ì—°ê²° ì‹¤íŒ¨: ${response.status} - ${errorText}`);
                }
                
                const answerSdp = await response.text();
                console.log('ğŸ“¥ SDP Answer ìˆ˜ì‹ ');
                
                await realtimePeerConnection.setRemoteDescription({
                    type: 'answer',
                    sdp: answerSdp,
                });
                
                console.log('âœ… WebRTC P2P ì—°ê²° ì™„ë£Œ!');
                
                document.getElementById('realtime-connect-webrtc-btn').style.display = 'none';
                document.getElementById('realtime-disconnect-webrtc-btn').style.display = 'inline-flex';
                document.getElementById('realtime-webrtc-connection-info').style.display = 'block';
                document.getElementById('realtime-webrtc-session-id').textContent = realtimeSessionId || 'N/A';
                
                const tokenPreview = realtimeCurrentToken.substring(0, 20) + '...' + realtimeCurrentToken.substring(realtimeCurrentToken.length - 10);
                document.getElementById('realtime-token-preview').textContent = tokenPreview;
                
            } catch (error) {
                console.error('âŒ WebRTC ì—°ê²° ì‹¤íŒ¨:', error);
                updateRealtimeWebRTCStatus('error', 'âŒ', 'ì—°ê²° ì‹¤íŒ¨: ' + error.message);
                alert('WebRTC ì—°ê²° ì‹¤íŒ¨: ' + error.message);
                
                if (realtimePeerConnection) {
                    realtimePeerConnection.close();
                    realtimePeerConnection = null;
                }
            } finally {
                loadingEl.classList.add('hidden');
                btnEl.disabled = false;
            }
        }

        function disconnectRealtimeWebRTC() {
            if (realtimeDataChannel) {
                realtimeDataChannel.close();
                realtimeDataChannel = null;
            }
            
            if (realtimePeerConnection) {
                realtimePeerConnection.close();
                realtimePeerConnection = null;
            }
            
            if (realtimeLocalStream) {
                realtimeLocalStream.getTracks().forEach(track => track.stop());
                realtimeLocalStream = null;
            }
            
            updateRealtimeWebRTCStatus('disconnected', 'ğŸ”´', 'ì—°ê²° ì•ˆ ë¨');
            updateRealtimeMicStatus('â¸ï¸ ë¹„í™œì„±');
            updateRealtimeSpeakerStatus('â¸ï¸ ë¹„í™œì„±');
            
            document.getElementById('realtime-connect-webrtc-btn').style.display = 'inline-flex';
            document.getElementById('realtime-disconnect-webrtc-btn').style.display = 'none';
            document.getElementById('realtime-voice-chat-section').style.display = 'none';
            document.getElementById('realtime-webrtc-connection-info').style.display = 'none';
            
            console.log('ğŸ”Œ WebRTC ì—°ê²° ì¢…ë£Œ');
        }

        function startRealtimeVoiceChat() {
            if (!realtimeDataChannel || realtimeDataChannel.readyState !== 'open') {
                alert('âŒ WebRTC ì—°ê²°ì´ í™œì„±í™”ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤!');
                return;
            }
            
            // í˜„ì¬ í¸ì§‘ ì¤‘ì¸ í”„ë¡¬í”„íŠ¸ ê°€ì ¸ì˜¤ê¸°
            const instructions = document.getElementById('realtime-instructions').value;
            
            // ê³ ê¸‰ ì„¤ì • ê°€ì ¸ì˜¤ê¸°
            const advancedConfig = getAdvancedConfig();
            
            realtimeDataChannel.send(JSON.stringify({
                type: 'response.create',
                response: {
                    output_modalities: ['text', 'audio'],
                    instructions: instructions || 'ì‚¬ìš©ìì˜ ë§ì„ ë“£ê³  ì¹œê·¼í•˜ê²Œ ì‘ë‹µí•´ì£¼ì„¸ìš”.',
                    temperature: advancedConfig.temperature,
                    max_output_tokens: advancedConfig.max_output_tokens === 'inf' ? null : advancedConfig.max_output_tokens
                }
            }));
            
            document.getElementById('realtime-start-voice-btn').style.display = 'none';
            document.getElementById('realtime-stop-voice-btn').style.display = 'inline-flex';
            
            addRealtimeChatMessage('system', `ğŸ¤ ìŒì„± ì…ë ¥ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. ì»¤ìŠ¤í…€ í”„ë¡¬í”„íŠ¸ë¡œ ëŒ€í™”í•©ë‹ˆë‹¤! (Temperature: ${advancedConfig.temperature}, Speed: ${advancedConfig.speed}x)`);
            console.log('ğŸ¤ ìŒì„± ì±„íŒ… ì‹œì‘', {
                prompt: instructions.substring(0, 50) + '...',
                temperature: advancedConfig.temperature,
                max_tokens: advancedConfig.max_output_tokens
            });
        }

        function stopRealtimeVoiceChat() {
            document.getElementById('realtime-start-voice-btn').style.display = 'inline-flex';
            document.getElementById('realtime-stop-voice-btn').style.display = 'none';
            
            addRealtimeChatMessage('system', 'â¹ï¸ ìŒì„± ì…ë ¥ì´ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.');
            console.log('â¹ï¸ ìŒì„± ì±„íŒ… ì¤‘ì§€');
        }

        function handleRealtimeWebRTCMessage(data) {
            try {
                const message = JSON.parse(data);
                console.log('ğŸ“¨ ìˆ˜ì‹  ë©”ì‹œì§€ íƒ€ì…:', message.type);
                
                if (message.type === 'conversation.item.input_audio_transcription.completed') {
                    addRealtimeChatMessage('user', message.transcript);
                }
                else if (message.type === 'response.audio_transcript.done') {
                    addRealtimeChatMessage('ai', message.transcript);
                }
                else if (message.type === 'response.done') {
                    console.log('âœ… AI ì‘ë‹µ ì™„ë£Œ');
                }
                else if (message.type === 'error') {
                    addRealtimeChatMessage('system', `âŒ ì—ëŸ¬: ${message.error.message}`);
                    console.error('âŒ ì—ëŸ¬:', message.error);
                }
            } catch (e) {
                console.warn('âš ï¸ ë©”ì‹œì§€ íŒŒì‹± ì‹¤íŒ¨:', data);
            }
        }

        function updateRealtimeWebRTCStatus(state, icon, text) {
            document.getElementById('realtime-webrtc-status-icon').textContent = icon;
            document.getElementById('realtime-webrtc-status-text').textContent = text;
        }

        function updateRealtimeMicStatus(status) {
            document.getElementById('realtime-mic-status').textContent = status;
        }

        function updateRealtimeSpeakerStatus(status) {
            document.getElementById('realtime-speaker-status').textContent = status;
        }

        function showRealtimeVoiceChatSection() {
            document.getElementById('realtime-voice-chat-section').style.display = 'block';
            setTimeout(() => {
                document.getElementById('realtime-voice-chat-section').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            }, 300);
        }

        function addRealtimeChatMessage(sender, text) {
            const messagesDiv = document.getElementById('realtime-chat-messages');
            const messageEl = document.createElement('div');
            messageEl.className = `chat-message ${sender}`;
            
            const prefix = sender === 'user' ? 'ğŸ‘¤ ì‚¬ìš©ì' : 
                         sender === 'ai' ? 'ğŸ¤– AI' : 
                         'ğŸ“¢ ì‹œìŠ¤í…œ';
            
            const timestamp = new Date().toLocaleTimeString('ko-KR');
            messageEl.innerHTML = `<strong>${prefix}</strong> [${timestamp}]: ${text}`;
            
            messagesDiv.appendChild(messageEl);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        // ============================================
        // ê³ ê¸‰ ì„¤ì • ê´€ë¦¬
        // ============================================

        // ê³ ê¸‰ ì„¤ì • ê¸°ë³¸ê°’
        const DEFAULT_ADVANCED_CONFIG = {
            temperature: 0.8,
            speed: 1.0,
            threshold: 0.5,
            prefix_padding_ms: 300,
            silence_duration_ms: 200,
            idle_timeout_ms: null,
            max_output_tokens: 'inf',
            noise_reduction: null,
            truncation: 'auto'
        };

        // í”„ë¦¬ì…‹ ì •ì˜
        const REALTIME_PRESETS = {
            balanced: {
                name: 'âš–ï¸ ê¸°ë³¸ (Balanced)',
                config: {
                    temperature: 0.8,
                    speed: 1.0,
                    threshold: 0.5,
                    prefix_padding_ms: 300,
                    silence_duration_ms: 200,
                    max_output_tokens: 'inf',
                    noise_reduction: null,
                    truncation: 'auto'
                }
            },
            fast_response: {
                name: 'âš¡ ë¹ ë¥¸ ì‘ë‹µ (Fast Response)',
                config: {
                    temperature: 0.6,
                    speed: 1.2,
                    threshold: 0.3,  // ë” ë¯¼ê°í•˜ê²Œ
                    prefix_padding_ms: 200,
                    silence_duration_ms: 100,  // ë¹ ë¥¸ ë°˜ì‘
                    max_output_tokens: 'inf',
                    noise_reduction: true,
                    truncation: 'auto'
                }
            },
            high_quality: {
                name: 'âœ¨ ë†’ì€ í’ˆì§ˆ (High Quality)',
                config: {
                    temperature: 0.9,
                    speed: 0.9,
                    threshold: 0.6,  // ëœ ë¯¼ê°í•˜ê²Œ
                    prefix_padding_ms: 400,
                    silence_duration_ms: 300,  // ì—¬ìœ ìˆê²Œ
                    max_output_tokens: 'inf',
                    noise_reduction: true,
                    truncation: 'disabled'
                }
            },
            custom: {
                name: 'ğŸ¨ ì»¤ìŠ¤í…€ (Custom)',
                config: null  // ì‚¬ìš©ìê°€ ì§ì ‘ ì„¤ì •
            }
        };

        // ê³ ê¸‰ ì„¤ì • í† ê¸€
        function toggleAdvancedSettings() {
            const settingsDiv = document.getElementById('realtime-advanced-settings');
            const toggleBtn = document.getElementById('advanced-settings-toggle');
            
            if (settingsDiv.style.display === 'none') {
                settingsDiv.style.display = 'block';
                toggleBtn.textContent = 'â–¼ ê³ ê¸‰ ì„¤ì • (Advanced Settings)';
            } else {
                settingsDiv.style.display = 'none';
                toggleBtn.textContent = 'â–¶ ê³ ê¸‰ ì„¤ì • (Advanced Settings)';
            }
        }

        // ìŠ¬ë¼ì´ë” ê°’ ì—…ë°ì´íŠ¸
        // í”„ë¦¬ì…‹ ì ìš© ì¤‘ì¸ì§€ í”Œë˜ê·¸
        let isApplyingPreset = false;

        function updateSliderValue(sliderId) {
            const slider = document.getElementById(sliderId);
            const valueSpan = document.getElementById(`${sliderId}-value`);
            
            let value = parseFloat(slider.value);
            
            // í‘œì‹œ í˜•ì‹ ì§€ì •
            if (sliderId.includes('speed')) {
                valueSpan.textContent = value.toFixed(1) + 'x';
            } else if (sliderId.includes('ms')) {
                valueSpan.textContent = Math.round(value) + 'ms';
            } else {
                valueSpan.textContent = value.toFixed(1);
            }

            // í”„ë¦¬ì…‹ ì ìš© ì¤‘ì´ ì•„ë‹ ë•Œë§Œ Customìœ¼ë¡œ ë³€ê²½
            if (!isApplyingPreset) {
                document.getElementById('realtime-preset').value = 'custom';
            }
        }

        // í”„ë¦¬ì…‹ ì„ íƒ ì‹œ ì²˜ë¦¬
        async function handlePresetChange(presetId) {
            if (!presetId) return;
            await switchAdvancedPreset(presetId);
        }
        
        // í”„ë¦¬ì…‹ ì ìš© (í•˜ìœ„ í˜¸í™˜ì„± ìœ ì§€)
        function applyRealtimePreset(presetName) {
            // ë ˆê±°ì‹œ í•¨ìˆ˜ - ì´ì œ handlePresetChangeë¡œ ì²˜ë¦¬ë¨
            console.log('applyRealtimePreset called with:', presetName);
        }
            
            const preset = REALTIME_PRESETS[presetName];
            if (!preset || !preset.config) return;
            
            const config = preset.config;
            
            // í”„ë¦¬ì…‹ ì ìš© ì¤‘ í”Œë˜ê·¸ ì„¤ì •
            isApplyingPreset = true;
            
            // UI ì—…ë°ì´íŠ¸
            document.getElementById('realtime-temperature').value = config.temperature;
            document.getElementById('realtime-speed').value = config.speed;
            document.getElementById('realtime-threshold').value = config.threshold;
            document.getElementById('realtime-prefix-padding').value = config.prefix_padding_ms;
            document.getElementById('realtime-silence-duration').value = config.silence_duration_ms;
            document.getElementById('realtime-max-tokens').value = config.max_output_tokens;
            document.getElementById('realtime-truncation').value = config.truncation;
            document.getElementById('realtime-noise-reduction').checked = config.noise_reduction === true;
            
            // ê°’ í‘œì‹œ ì—…ë°ì´íŠ¸
            updateSliderValue('realtime-temperature');
            updateSliderValue('realtime-speed');
            updateSliderValue('realtime-threshold');
            updateSliderValue('realtime-prefix-padding');
            updateSliderValue('realtime-silence-duration');
            
            // í”„ë¦¬ì…‹ ì ìš© ì™„ë£Œ
            isApplyingPreset = false;
            
            console.log(`âœ… í”„ë¦¬ì…‹ ì ìš©: ${preset.name}`);
        }

        // ê³ ê¸‰ ì„¤ì • ê¸°ë³¸ê°’ìœ¼ë¡œ ë¦¬ì…‹
        function resetAdvancedSettings() {
            applyRealtimePreset('balanced');
            document.getElementById('realtime-preset').value = 'balanced';
            alert('âœ… ê³ ê¸‰ ì„¤ì •ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ë¦¬ì…‹í–ˆìŠµë‹ˆë‹¤.');
        }

        // í˜„ì¬ ê³ ê¸‰ ì„¤ì • ê°€ì ¸ì˜¤ê¸°
        function getAdvancedConfig() {
            return {
                temperature: parseFloat(document.getElementById('realtime-temperature').value),
                speed: parseFloat(document.getElementById('realtime-speed').value),
                threshold: parseFloat(document.getElementById('realtime-threshold').value),
                prefix_padding_ms: parseInt(document.getElementById('realtime-prefix-padding').value),
                silence_duration_ms: parseInt(document.getElementById('realtime-silence-duration').value),
                idle_timeout_ms: null,  // ê³ ì •ê°’
                max_output_tokens: document.getElementById('realtime-max-tokens').value === 'inf' ? 
                    'inf' : parseInt(document.getElementById('realtime-max-tokens').value),
                noise_reduction: document.getElementById('realtime-noise-reduction').checked ? true : null,
                truncation: document.getElementById('realtime-truncation').value
            };
        }

        // ê³ ê¸‰ ì„¤ì • UIì— ë°˜ì˜
        function loadAdvancedConfig(config) {
            if (!config || Object.keys(config).length === 0) {
                config = DEFAULT_ADVANCED_CONFIG;
            }
            
            // í”„ë¦¬ì…‹ ì ìš© ì¤‘ í”Œë˜ê·¸ ì„¤ì •
            isApplyingPreset = true;
            
            document.getElementById('realtime-temperature').value = config.temperature || 0.8;
            document.getElementById('realtime-speed').value = config.speed || 1.0;
            document.getElementById('realtime-threshold').value = config.threshold || 0.5;
            document.getElementById('realtime-prefix-padding').value = config.prefix_padding_ms || 300;
            document.getElementById('realtime-silence-duration').value = config.silence_duration_ms || 200;
            document.getElementById('realtime-max-tokens').value = config.max_output_tokens || 'inf';
            document.getElementById('realtime-truncation').value = config.truncation || 'auto';
            document.getElementById('realtime-noise-reduction').checked = config.noise_reduction === true;
            
            // ê°’ í‘œì‹œ ì—…ë°ì´íŠ¸
            updateSliderValue('realtime-temperature');
            updateSliderValue('realtime-speed');
            updateSliderValue('realtime-threshold');
            updateSliderValue('realtime-prefix-padding');
            updateSliderValue('realtime-silence-duration');
            
            // ê¸°ë³¸ê°’ê³¼ ë¹„êµí•˜ì—¬ í”„ë¦¬ì…‹ ìë™ ê°ì§€
            const isDefault = JSON.stringify(config) === JSON.stringify(DEFAULT_ADVANCED_CONFIG);
            const isBalanced = JSON.stringify(config) === JSON.stringify(REALTIME_PRESETS.balanced.config);
            const isFastResponse = JSON.stringify(config) === JSON.stringify(REALTIME_PRESETS.fast_response.config);
            const isHighQuality = JSON.stringify(config) === JSON.stringify(REALTIME_PRESETS.high_quality.config);
            
            if (isDefault || isBalanced) {
                document.getElementById('realtime-preset').value = 'balanced';
            } else if (isFastResponse) {
                document.getElementById('realtime-preset').value = 'fast_response';
            } else if (isHighQuality) {
                document.getElementById('realtime-preset').value = 'high_quality';
            } else {
                document.getElementById('realtime-preset').value = 'custom';
            }
            
            // í”„ë¦¬ì…‹ ì ìš© ì™„ë£Œ
            isApplyingPreset = false;
        }

        // ì»¤ìŠ¤í…€ í”„ë¦¬ì…‹ìœ¼ë¡œ ì €ì¥ (DBì— ê³ ê¸‰ ì„¤ì •ë§Œ ì €ì¥)
        async function saveAdvancedSettingsToPreset() {
            const config = getAdvancedConfig();
            
            // í”„ë¦¬ì…‹ ì´ë¦„ ì…ë ¥ë°›ê¸°
            const presetName = prompt('ì»¤ìŠ¤í…€ í”„ë¦¬ì…‹ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:', `ì»¤ìŠ¤í…€${new Date().toLocaleString('ko-KR', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' })}`);
            if (!presetName) return;
            
            try {
                // DBì— ê³ ê¸‰ ì„¤ì •ë§Œ ì €ì¥
                const response = await fetch(`${API_BASE_URL}/api/advanced-presets`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        endpoint: 'realtime',
                        presetName: presetName,
                        config: config
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert(`âœ… "${presetName}" í”„ë¦¬ì…‹ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\n\ní”„ë¦¬ì…‹ ë“œë¡­ë‹¤ìš´ì—ì„œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
                    
                    // í”„ë¦¬ì…‹ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    await loadAdvancedPresets();
                    
                    // í˜„ì¬ í”„ë¦¬ì…‹ìœ¼ë¡œ ì „í™˜í• ì§€ ë¬¼ì–´ë³´ê¸°
                    if (confirm('ì´ í”„ë¦¬ì…‹ì„ í˜„ì¬ í™œì„± í”„ë¦¬ì…‹ìœ¼ë¡œ ì „í™˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                        await switchAdvancedPreset(result.preset.id);
                    }
                    
                    console.log('ğŸ’¾ ì €ì¥ëœ ì»¤ìŠ¤í…€ í”„ë¦¬ì…‹:', config);
                } else {
                    alert(`âŒ ì €ì¥ ì‹¤íŒ¨: ${result.error}`);
                }
            } catch (error) {
                alert(`âŒ ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
                console.error('âŒ ì»¤ìŠ¤í…€ í”„ë¦¬ì…‹ ì €ì¥ ì‹¤íŒ¨:', error);
            }
        }
        
        // ê³ ê¸‰ í”„ë¦¬ì…‹ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadAdvancedPresets() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/advanced-presets?endpoint=realtime`);
                const result = await response.json();
                
                if (result.success) {
                    // í”„ë¦¬ì…‹ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
                    const presetSelect = document.getElementById('realtime-preset');
                    presetSelect.innerHTML = '';
                    
                    result.presets.forEach(preset => {
                        const option = document.createElement('option');
                        option.value = preset.id;
                        option.textContent = preset.presetName;
                        if (preset.isCurrent) {
                            option.selected = true;
                        }
                        presetSelect.appendChild(option);
                    });
                    
                    console.log('âœ… ê³ ê¸‰ í”„ë¦¬ì…‹ ëª©ë¡ ë¡œë“œ:', result.presets.length);
                    return result.presets;
                } else {
                    console.error('âŒ í”„ë¦¬ì…‹ ë¡œë“œ ì‹¤íŒ¨:', result.error);
                    return [];
                }
            } catch (error) {
                console.error('âŒ í”„ë¦¬ì…‹ ë¡œë“œ ì˜¤ë¥˜:', error);
                return [];
            }
        }
        
        // ê³ ê¸‰ í”„ë¦¬ì…‹ ì „í™˜
        async function switchAdvancedPreset(presetId) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/advanced-presets`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        endpoint: 'realtime',
                        presetId: presetId
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // UIì— í”„ë¦¬ì…‹ ì ìš©
                    loadAdvancedConfig({
                        temperature: result.preset.temperature,
                        speed: result.preset.speed,
                        threshold: result.preset.threshold,
                        prefix_padding_ms: result.preset.prefixPaddingMs,
                        silence_duration_ms: result.preset.silenceDurationMs,
                        idle_timeout_ms: result.preset.idleTimeoutMs,
                        max_output_tokens: result.preset.maxOutputTokens,
                        noise_reduction: result.preset.noiseReduction,
                        truncation: result.preset.truncation
                    });
                    
                    console.log(`âœ… í”„ë¦¬ì…‹ ì „í™˜: ${result.preset.presetName}`);
                } else {
                    console.error('âŒ í”„ë¦¬ì…‹ ì „í™˜ ì‹¤íŒ¨:', result.error);
                }
            } catch (error) {
                console.error('âŒ í”„ë¦¬ì…‹ ì „í™˜ ì˜¤ë¥˜:', error);
            }
        }
        
        // í”„ë¦¬ì…‹ íˆìŠ¤í† ë¦¬ í† ê¸€
        function togglePresetHistory() {
            const history = document.getElementById('realtime-preset-history');
            if (history.style.display === 'none' || history.style.display === '') {
                history.style.display = 'block';
                renderPresetHistory();
            } else {
                history.style.display = 'none';
            }
        }
        
        // í”„ë¦¬ì…‹ íˆìŠ¤í† ë¦¬ ë Œë”ë§
        async function renderPresetHistory() {
            const history = document.getElementById('realtime-preset-history');
            if (!history) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/advanced-presets?endpoint=realtime`);
                const result = await response.json();
                
                if (result.success) {
                    const presets = result.presets;
                    
                    let html = '<h4 style="margin-top: 15px;">ğŸ“œ í”„ë¦¬ì…‹ íˆìŠ¤í† ë¦¬</h4>';
                    
                    for (const preset of presets) {
                        const isCurrent = preset.isCurrent;
                        const isSystem = preset.isSystem;
                        const itemClass = isCurrent ? 'version-item current' : 'version-item';
                        
                        // í”„ë¦¬ì…‹ íŒŒë¼ë¯¸í„° ìƒì„¸ ì •ë³´
                        const configDetails = `
                            <div style="margin-top: 8px; padding: 10px; background: #f0f4ff; border-radius: 5px; font-size: 0.85rem;">
                                <strong>ğŸ›ï¸ íŒŒë¼ë¯¸í„°:</strong><br>
                                â€¢ Temperature: ${preset.temperature || 0.8}<br>
                                â€¢ Speed: ${preset.speed || 1.0}x<br>
                                â€¢ Threshold: ${preset.threshold || 0.5}<br>
                                â€¢ Prefix Padding: ${preset.prefixPaddingMs || 300}ms<br>
                                â€¢ Silence Duration: ${preset.silenceDurationMs || 200}ms<br>
                                â€¢ Max Tokens: ${preset.maxOutputTokens || 'inf'}<br>
                                â€¢ Noise Reduction: ${preset.noiseReduction ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”'}<br>
                                â€¢ Truncation: ${preset.truncation || 'auto'}
                            </div>
                        `;
                        
                        html += `
                            <div class="${itemClass}" style="margin-bottom: 10px; padding: 15px; background: white; border: 2px solid ${isCurrent ? '#667eea' : '#ddd'}; border-radius: 10px;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <span style="font-size: 1.1rem; font-weight: bold; color: #667eea;">
                                            ${isSystem ? 'ğŸ”’ ' : ''}${preset.presetName}
                                        </span>
                                        ${isCurrent ? '<span style="margin-left: 10px; color: #28a745; font-weight: bold;">âœ… í˜„ì¬ í”„ë¦¬ì…‹</span>' : ''}
                                    </div>
                                </div>
                                <div style="margin-top: 5px; font-size: 0.9rem; color: #666;">
                                    <small>${isSystem ? 'ì‹œìŠ¤í…œ í”„ë¦¬ì…‹' : new Date(preset.createdAt).toLocaleString('ko-KR')}</small>
                                </div>
                                ${configDetails}
                                <div style="margin-top: 10px; display: flex; gap: 10px;">
                                    ${isCurrent ? 
                                        '<button class="btn-small" disabled>í˜„ì¬ ì‚¬ìš© ì¤‘</button>' : 
                                        `<button class="btn-small" onclick="switchAdvancedPreset('${preset.id}'); renderPresetHistory();">ì´ í”„ë¦¬ì…‹ìœ¼ë¡œ ì „í™˜</button>`
                                    }
                                    ${!isSystem && !isCurrent ? 
                                        `<button class="btn-small btn-danger" onclick="deletePreset('${preset.id}')">ì‚­ì œ</button>` :
                                        '<button class="btn-small" disabled title="ì‹œìŠ¤í…œ í”„ë¦¬ì…‹ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤">ì‚­ì œ ë¶ˆê°€</button>'
                                    }
                                </div>
                            </div>
                        `;
                    }
                    
                    history.innerHTML = html;
                } else {
                    history.innerHTML = '<p style="color: red;">í”„ë¦¬ì…‹ íˆìŠ¤í† ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>';
                }
            } catch (error) {
                history.innerHTML = '<p style="color: red;">í”„ë¦¬ì…‹ íˆìŠ¤í† ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>';
                console.error('Failed to render preset history:', error);
            }
        }
        
        // í”„ë¦¬ì…‹ ì‚­ì œ
        async function deletePreset(presetId) {
            if (!confirm('ì •ë§ë¡œ ì´ í”„ë¦¬ì…‹ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/advanced-presets`, {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        endpoint: 'realtime',
                        presetId: presetId
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert(`âœ… í”„ë¦¬ì…‹ "${result.deletedPreset.name}"ì´(ê°€) ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                    
                    // í”„ë¦¬ì…‹ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    await loadAdvancedPresets();
                    
                    // íˆìŠ¤í† ë¦¬ ë‹¤ì‹œ ë Œë”ë§
                    await renderPresetHistory();
                    
                    console.log('âœ… í”„ë¦¬ì…‹ ì‚­ì œ ì™„ë£Œ:', result.deletedPreset);
                } else {
                    alert(`âŒ ì‚­ì œ ì‹¤íŒ¨: ${result.error}`);
                }
            } catch (error) {
                alert(`âŒ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
                console.error('âŒ í”„ë¦¬ì…‹ ì‚­ì œ ì‹¤íŒ¨:', error);
            }
        }

        // ============================================
        // ì „ì—­ í•¨ìˆ˜ ë…¸ì¶œ (onclickì—ì„œ ì‚¬ìš©)
        // ============================================
        
        // ì´ë¯¸ ì „ì—­ìœ¼ë¡œ ì„ ì–¸ëœ í•¨ìˆ˜ë“¤ì€ ìœ ì§€
        // async functionìœ¼ë¡œ ì„ ì–¸ëœ í•¨ìˆ˜ë“¤ì„ windowì— í• ë‹¹
        window.testPrompt = testPrompt;
        window.connectRealtimeWebRTC = connectRealtimeWebRTC;
        window.disconnectRealtimeWebRTC = disconnectRealtimeWebRTC;
        window.startRealtimeVoiceChat = startRealtimeVoiceChat;
        window.stopRealtimeVoiceChat = stopRealtimeVoiceChat;
        window.loadSample = loadSample;
        window.clearInput = clearInput;
        window.toggleVersionHistory = toggleVersionHistory;
        window.toggleAdvancedSettings = toggleAdvancedSettings;
        window.togglePresetHistory = togglePresetHistory;
        window.resetAdvancedSettings = resetAdvancedSettings;
        window.saveAdvancedSettingsToPreset = saveAdvancedSettingsToPreset;
        window.exportAllVersions = exportAllVersions;
        window.importVersions = importVersions;
        window.handlePresetChange = handlePresetChange;
        window.updateSliderValue = updateSliderValue;

        // ============================================
        // ì´ˆê¸°í™”
        // ============================================

        document.addEventListener('DOMContentLoaded', async () => {
            // LocalStorage ì´ˆê¸°í™” (ë°±ì—…ìš©)
            initializeStorage();
            
            // ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ íƒ­ ë¡œë“œ (DBì—ì„œ ê°€ì ¸ì˜¤ê¸°)
            await loadPromptForTab('organize-diary');
            await loadPromptForTab('context-extract');
            await loadPromptForTab('tts');
            await loadPromptForTab('realtime');
            
            // ê³ ê¸‰ í”„ë¦¬ì…‹ ë¡œë“œ (realtime ì „ìš©)
            await loadAdvancedPresets();
            
            // í˜„ì¬ í™œì„± í”„ë¦¬ì…‹ ì ìš©
            const currentPreset = document.querySelector('#realtime-preset option[selected]');
            if (currentPreset) {
                await handlePresetChange(currentPreset.value);
            }
            
            console.log('âœ… ëª¨ë“  í”„ë¡¬í”„íŠ¸ íƒ­ + ê³ ê¸‰ í”„ë¦¬ì…‹ ë¡œë“œ ì™„ë£Œ');
            
            // ëª¨ë“  ìºë¦­í„° ì¹´ìš´í„° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            const textareas = document.querySelectorAll('textarea');
            textareas.forEach(textarea => {
                textarea.addEventListener('input', () => {
                    updateCharCounter(textarea.id);
                });
                updateCharCounter(textarea.id);
            });
            
            // ì €ì¥ ê³µê°„ ì‚¬ìš©ëŸ‰ í‘œì‹œ
            updateStorageUsage();
            
            console.log('âœ… í”„ë¡¬í”„íŠ¸ í”Œë ˆì´ê·¸ë¼ìš´ë“œ ì´ˆê¸°í™” ì™„ë£Œ! (DB ì—°ë™ + ê³ ê¸‰ ì„¤ì •)');
        });
    </script>
</body>
</html>
