<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”„ë¡¬í”„íŠ¸ í…ŒìŠ¤íŠ¸ í”Œë ˆì´ê·¸ë¼ìš´ë“œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.95;
        }

        .content {
            padding: 30px;
        }

        /* íƒ­ ìŠ¤íƒ€ì¼ */
        .tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 30px;
            gap: 10px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 15px 25px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: #666;
            border-radius: 8px 8px 0 0;
            transition: all 0.3s;
        }

        .tab:hover {
            background: #e9ecef;
            color: #333;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .section {
            margin-bottom: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
        }

        .section h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* ë²„ì „ í—¤ë” */
        .version-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 2px solid #667eea;
        }

        .version-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .version-badge {
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .version-badge.default {
            background: #28a745;
        }

        .version-name {
            font-weight: 600;
            color: #333;
        }

        .version-date {
            color: #666;
            font-size: 0.9rem;
        }

        /* í¼ ê·¸ë£¹ */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 1rem;
        }

        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            font-family: 'Monaco', 'Courier New', monospace;
            resize: vertical;
            min-height: 150px;
            transition: border-color 0.2s;
        }

        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea.prompt-editor {
            min-height: 250px;
            background: #2d2d2d;
            color: #f8f8f2;
        }

        .form-group input[type="text"],
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            margin-right: 10px;
            margin-top: 10px;
            transition: transform 0.2s, box-shadow 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-small {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-right: 8px;
            margin-bottom: 8px;
            transition: background 0.2s;
        }

        .btn-small:hover {
            background: #5a6268;
        }

        .btn-small.btn-danger {
            background: #dc3545;
        }

        .btn-small.btn-danger:hover {
            background: #c82333;
        }

        .btn-small.btn-success {
            background: #28a745;
        }

        .btn-small.btn-success:hover {
            background: #218838;
        }

        /* ë²„ì „ íˆìŠ¤í† ë¦¬ */
        .version-history {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            max-height: 500px;
            overflow-y: auto;
            display: none;
        }

        .version-history.show {
            display: block;
        }

        .version-history h4 {
            margin-bottom: 15px;
            color: #333;
        }

        .version-item {
            padding: 15px;
            margin-bottom: 10px;
            background: white;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            transition: border-color 0.2s;
        }

        .version-item:hover {
            border-color: #667eea;
        }

        .version-item.current {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .version-item.default-version {
            border-color: #28a745;
            background: #f0fff4;
        }

        .version-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .version-item-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .version-status {
            color: #667eea;
            font-weight: bold;
            margin-left: 10px;
        }

        .version-meta {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .version-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        /* ì‘ë‹µ ì˜ì—­ */
        .response {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            max-height: 600px;
            overflow-y: auto;
            animation: fadeIn 0.3s;
        }

        .response.success {
            background: #d4edda;
            border: 2px solid #c3e6cb;
            color: #155724;
        }

        .response.error {
            background: #f8d7da;
            border: 2px solid #f5c6cb;
            color: #721c24;
        }

        .result-section {
            margin: 15px 0;
            padding: 12px;
            background: rgba(255,255,255,0.5);
            border-radius: 5px;
        }

        .result-section strong {
            display: block;
            margin-bottom: 8px;
            font-size: 1.05rem;
        }

        .result-section p {
            margin: 5px 0;
            line-height: 1.6;
        }

        .result-section ul {
            margin: 5px 0;
            padding-left: 25px;
        }

        .result-section li {
            margin: 5px 0;
            line-height: 1.5;
        }

        .meta-info {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(0,0,0,0.1);
            text-align: right;
            opacity: 0.8;
        }

        /* ë¡œë”© */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        /* ìƒ˜í”Œ ë²„íŠ¼ */
        .sample-buttons {
            margin: 15px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        /* Backup ì„¹ì…˜ */
        .backup-section {
            padding: 20px;
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .backup-section h4 {
            margin-bottom: 15px;
            color: #856404;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .content {
                padding: 20px;
            }
            
            .section {
                padding: 20px;
            }

            .tabs {
                gap: 5px;
            }

            .tab {
                padding: 12px 16px;
                font-size: 0.9rem;
            }

            .version-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }

        /* ì¶”ê°€: ìºë¦­í„° ì¹´ìš´í„° */
        .char-counter {
            text-align: right;
            color: #666;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        /* WebRTC í…ŒìŠ¤íŠ¸ ì „ìš© ìŠ¤íƒ€ì¼ */
        .connection-status-box {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            margin: 20px 0;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .status-icon {
            font-size: 2rem;
        }

        .status-text {
            color: #333;
        }

        .audio-status-box {
            display: flex;
            gap: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            margin: 20px 0;
        }

        .audio-item {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
        }

        .audio-icon {
            font-size: 2.5rem;
        }

        .audio-item strong {
            display: block;
            color: #333;
            margin-bottom: 5px;
        }

        .audio-item p {
            color: #666;
            margin: 0;
            font-size: 0.95rem;
        }

        .chat-log {
            margin-top: 30px;
        }

        .chat-log h4 {
            margin-bottom: 15px;
            color: #333;
        }

        .chat-messages {
            max-height: 400px;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }

        .chat-message {
            padding: 12px 0;
            border-bottom: 1px solid #e0e0e0;
            line-height: 1.6;
        }

        .chat-message:last-child {
            border-bottom: none;
        }

        .chat-message.user {
            color: #667eea;
        }

        .chat-message.user strong {
            color: #667eea;
        }

        .chat-message.ai {
            color: #28a745;
        }

        .chat-message.ai strong {
            color: #28a745;
        }

        .chat-message.system {
            color: #6c757d;
            font-style: italic;
        }

        .chat-message.system strong {
            color: #6c757d;
        }

        .info-box {
            padding: 20px;
            background: #e7f3ff;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .info-box h4 {
            margin-bottom: 15px;
            color: #333;
        }

        .info-box table {
            font-size: 0.9rem;
        }

        .info-box table th {
            font-weight: 600;
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¨ í”„ë¡¬í”„íŠ¸ í…ŒìŠ¤íŠ¸ í”Œë ˆì´ê·¸ë¼ìš´ë“œ</h1>
            <p>LLM í”„ë¡¬í”„íŠ¸ë¥¼ ìˆ˜ì •í•˜ê³  ì‹¤ì‹œê°„ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”</p>
        </div>

        <div class="content">
            <!-- ë°±ì—… ì„¹ì…˜ -->
            <div class="backup-section">
                <h4>ğŸ’¾ ë°ì´í„° ë°±ì—… & ê³µìœ </h4>
                <button class="btn-small" onclick="exportAllVersions()">
                    ğŸ“¥ ëª¨ë“  ë²„ì „ ë‹¤ìš´ë¡œë“œ (JSON)
                </button>
                <button class="btn-small" onclick="document.getElementById('import-file').click()">
                    ğŸ“¤ ë²„ì „ ë¶ˆëŸ¬ì˜¤ê¸°
                </button>
                <input type="file" id="import-file" accept=".json" style="display:none" 
                       onchange="importVersions(this.files[0])">
                
                <p style="font-size: 0.9rem; color: #856404; margin-top: 10px;">
                    ğŸ’¡ íŒŒì¼ë¡œ ì €ì¥í•˜ë©´ ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ë‚˜ ë™ë£Œì™€ ê³µìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤! ì •ê¸°ì ìœ¼ë¡œ ë°±ì—…í•˜ì„¸ìš”.
                </p>
                <p id="storage-usage" style="font-size: 0.9rem; color: #856404; margin-top: 5px;"></p>
            </div>

            <!-- íƒ­ ë©”ë‰´ -->
            <div class="tabs">
                <button class="tab active" onclick="switchTab('organize-diary')">ì¼ê¸° ì •ë¦¬</button>
                <button class="tab" onclick="switchTab('context-extract')">ì»¨í…ìŠ¤íŠ¸ ì¶”ì¶œ</button>
                <button class="tab" onclick="switchTab('tts')">ìŒì„± í•©ì„± (TTS)</button>
                <button class="tab" onclick="switchTab('realtime')">ì‹¤ì‹œê°„ ëŒ€í™”</button>
            </div>

            <!-- íƒ­ 1: ì¼ê¸° ì •ë¦¬ -->
            <div id="tab-organize-diary" class="tab-content active">
                <!-- í…ŒìŠ¤íŠ¸ ì…ë ¥ ì„¹ì…˜ -->
                <div class="section">
                    <h3>ğŸ’¬ í…ŒìŠ¤íŠ¸ ì…ë ¥</h3>
                    <div class="form-group">
                        <label for="diary-input">ìŒì„± ì „ì‚¬ í…ìŠ¤íŠ¸ ì…ë ¥:</label>
                        <textarea id="diary-input" placeholder="ì˜¤ëŠ˜ ìˆì—ˆë˜ ì¼ë“¤ì„ ììœ ë¡­ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”...&#10;&#10;ì˜ˆ: ì˜¤ëŠ˜ì€ ì•„ì¹¨ ì¼ì° ì¼ì–´ë‚˜ì„œ 30ë¶„ ì¡°ê¹…ì„ í–ˆì–´ìš”. ë‚ ì”¨ê°€ ë„ˆë¬´ ì¢‹ì•„ì„œ ê¸°ë¶„ì´ ìƒì¾Œí–ˆìŠµë‹ˆë‹¤..."></textarea>
                        <div class="char-counter" id="diary-input-counter">0ì</div>
                    </div>

                    <div class="sample-buttons">
                        <strong style="display: block; width: 100%; margin-bottom: 10px; color: #555;">ìƒ˜í”Œ ë°ì´í„°:</strong>
                        <button class="btn-small" onclick="loadSample('organize-diary', 1)">ğŸ“ ìƒ˜í”Œ 1: ì¼ìƒ ì´ì•¼ê¸°</button>
                        <button class="btn-small" onclick="loadSample('organize-diary', 2)">ğŸ’ª ìƒ˜í”Œ 2: ìš´ë™ ì¼ê¸°</button>
                        <button class="btn-small" onclick="loadSample('organize-diary', 3)">ğŸ˜Š ìƒ˜í”Œ 3: ì§§ì€ ì¼ê¸°</button>
                        <button class="btn-small" onclick="clearInput('organize-diary')">ğŸ—‘ï¸ ì§€ìš°ê¸°</button>
                    </div>
                </div>

                <!-- í”„ë¡¬í”„íŠ¸ í¸ì§‘ ì„¹ì…˜ -->
                <div class="section">
                    <h3>ğŸ§  í”„ë¡¬í”„íŠ¸ í¸ì§‘</h3>
                    
                    <!-- ë²„ì „ í—¤ë” -->
                    <div class="version-header">
                        <div class="version-info">
                            <span class="version-badge" id="diary-version-badge">v0</span>
                            <span class="version-name" id="diary-version-name">Default</span>
                            <span class="version-date" id="diary-version-date"></span>
                        </div>
                        <button class="btn-small btn-success" onclick="toggleVersionHistory('organize-diary')">
                            ğŸ“œ íˆìŠ¤í† ë¦¬ ë³´ê¸°
                        </button>
                    </div>

                    <div class="form-group">
                        <label for="diary-prompt">System Prompt:</label>
                        <textarea id="diary-prompt" class="prompt-editor" placeholder="í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                        <div class="char-counter" id="diary-prompt-counter">0ì</div>
                    </div>

                    <button class="btn-small" onclick="resetToDefault('organize-diary')">ğŸ”„ Defaultë¡œ ë˜ëŒë¦¬ê¸°</button>
                    <button class="btn-small btn-success" onclick="saveAsNewVersion('organize-diary')">ğŸ’¾ ìƒˆ ë²„ì „ìœ¼ë¡œ ì €ì¥</button>

                    <!-- ë²„ì „ íˆìŠ¤í† ë¦¬ -->
                    <div class="version-history" id="diary-version-history"></div>
                </div>

                <!-- í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë²„íŠ¼ -->
                <button class="btn" onclick="testPrompt('organize-diary')" id="diary-test-btn">
                    <span>ğŸš€ ì´ í”„ë¡¬í”„íŠ¸ë¡œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</span>
                    <span class="loading hidden" id="diary-loading"></span>
                </button>

                <!-- ê²°ê³¼ ì„¹ì…˜ -->
                <div class="response hidden" id="diary-response"></div>
            </div>

            <!-- íƒ­ 2: ì»¨í…ìŠ¤íŠ¸ ì¶”ì¶œ (placeholder) -->
            <div id="tab-context-extract" class="tab-content">
                <div class="section">
                    <h3>ğŸ’¬ í…ŒìŠ¤íŠ¸ ì…ë ¥</h3>
                    <div class="form-group">
                        <label for="context-input">ëŒ€í™” ë‚´ìš©:</label>
                        <textarea id="context-input" placeholder="ì‚¬ìš©ì: ì˜¤ëŠ˜ ìš´ë™ì„ í–ˆì–´ìš”&#10;AI: ì¢‹ì€ ìŠµê´€ì´ë„¤ìš”! ì–´ë–¤ ìš´ë™ì„ í•˜ì…¨ë‚˜ìš”?&#10;ì‚¬ìš©ì: ì¡°ê¹… 30ë¶„ í–ˆìŠµë‹ˆë‹¤"></textarea>
                        <div class="char-counter" id="context-input-counter">0ì</div>
                    </div>
                </div>

                <div class="section">
                    <h3>ğŸ§  í”„ë¡¬í”„íŠ¸ í¸ì§‘</h3>
                    
                    <div class="version-header">
                        <div class="version-info">
                            <span class="version-badge" id="context-version-badge">v0</span>
                            <span class="version-name" id="context-version-name">Default</span>
                            <span class="version-date" id="context-version-date"></span>
                        </div>
                        <button class="btn-small btn-success" onclick="toggleVersionHistory('context-extract')">
                            ğŸ“œ íˆìŠ¤í† ë¦¬ ë³´ê¸°
                        </button>
                    </div>

                    <div class="form-group">
                        <label for="context-prompt">Custom Prompt:</label>
                        <textarea id="context-prompt" class="prompt-editor"></textarea>
                        <div class="char-counter" id="context-prompt-counter">0ì</div>
                    </div>

                    <button class="btn-small" onclick="resetToDefault('context-extract')">ğŸ”„ Defaultë¡œ ë˜ëŒë¦¬ê¸°</button>
                    <button class="btn-small btn-success" onclick="saveAsNewVersion('context-extract')">ğŸ’¾ ìƒˆ ë²„ì „ìœ¼ë¡œ ì €ì¥</button>

                    <div class="version-history" id="context-version-history"></div>
                </div>

                <button class="btn" onclick="testPrompt('context-extract')" id="context-test-btn">
                    <span>ğŸš€ ì´ í”„ë¡¬í”„íŠ¸ë¡œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</span>
                    <span class="loading hidden" id="context-loading"></span>
                </button>

                <div class="response hidden" id="context-response"></div>
            </div>

            <!-- íƒ­ 3: TTS (placeholder) -->
            <div id="tab-tts" class="tab-content">
                <div class="section">
                    <h3>ğŸ’¬ í…ŒìŠ¤íŠ¸ ì…ë ¥</h3>
                    <div class="form-group">
                        <label for="tts-input">í…ìŠ¤íŠ¸ ì…ë ¥:</label>
                        <textarea id="tts-input" placeholder="ì•ˆë…•í•˜ì„¸ìš”! ë§Œë‚˜ì„œ ë°˜ê°‘ìŠµë‹ˆë‹¤." style="min-height: 100px;"></textarea>
                        <div class="char-counter" id="tts-input-counter">0ì</div>
                    </div>

                    <div class="form-group">
                        <label for="tts-voice">ìŒì„± ì„ íƒ:</label>
                        <select id="tts-voice">
                            <option value="alloy">Alloy (ì¤‘ì„±ì )</option>
                            <option value="echo">Echo (ë‚¨ì„±)</option>
                            <option value="fable">Fable (ì˜êµ­ ë‚¨ì„±)</option>
                            <option value="onyx">Onyx (ê¹Šì€ ë‚¨ì„±)</option>
                            <option value="nova">Nova (ì—¬ì„±)</option>
                            <option value="shimmer">Shimmer (ë°ì€ ì—¬ì„±)</option>
                        </select>
                    </div>
                </div>

                <div class="section">
                    <h3>ğŸ§  Instructions í¸ì§‘</h3>
                    
                    <div class="version-header">
                        <div class="version-info">
                            <span class="version-badge" id="tts-version-badge">v0</span>
                            <span class="version-name" id="tts-version-name">Default</span>
                            <span class="version-date" id="tts-version-date"></span>
                        </div>
                        <button class="btn-small btn-success" onclick="toggleVersionHistory('tts')">
                            ğŸ“œ íˆìŠ¤í† ë¦¬ ë³´ê¸°
                        </button>
                    </div>

                    <div class="form-group">
                        <label for="tts-instructions">TTS Instructions:</label>
                        <textarea id="tts-instructions" class="prompt-editor" style="min-height: 120px;"></textarea>
                        <div class="char-counter" id="tts-instructions-counter">0ì</div>
                    </div>

                    <button class="btn-small" onclick="resetToDefault('tts')">ğŸ”„ Defaultë¡œ ë˜ëŒë¦¬ê¸°</button>
                    <button class="btn-small btn-success" onclick="saveAsNewVersion('tts')">ğŸ’¾ ìƒˆ ë²„ì „ìœ¼ë¡œ ì €ì¥</button>

                    <div class="version-history" id="tts-version-history"></div>
                </div>

                <button class="btn" onclick="testPrompt('tts')" id="tts-test-btn">
                    <span>ğŸš€ ìŒì„± ìƒì„±í•˜ê¸°</span>
                    <span class="loading hidden" id="tts-loading"></span>
                </button>

                <div class="response hidden" id="tts-response"></div>
            </div>

            <!-- íƒ­ 4: Realtime (placeholder) -->
            <div id="tab-realtime" class="tab-content">
                <div class="section">
                    <h3>âš™ï¸ ì„¸ì…˜ ì„¤ì •</h3>
                    
                    <div class="form-group">
                        <label for="realtime-model">ëª¨ë¸ ì„ íƒ:</label>
                        <select id="realtime-model">
                            <option value="gpt-4o-realtime-preview-2024-12-17">GPT-4o Realtime (2024-12-17) - ê¶Œì¥</option>
                            <option value="gpt-4o-mini-realtime-preview">GPT-4o Mini Realtime</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="realtime-voice">ìŒì„± ì„ íƒ:</label>
                        <select id="realtime-voice">
                            <option value="alloy">Alloy (ì¤‘ì„±ì )</option>
                            <option value="echo">Echo (ë‚¨ì„±)</option>
                            <option value="shimmer">Shimmer (ë°ì€ ì—¬ì„±)</option>
                            <option value="ash">Ash</option>
                            <option value="ballad">Ballad</option>
                            <option value="coral">Coral</option>
                            <option value="sage">Sage</option>
                            <option value="verse">Verse</option>
                        </select>
                    </div>
                </div>

                <div class="section">
                    <h3>ğŸ§  System Instructions í¸ì§‘</h3>
                    
                    <div class="version-header">
                        <div class="version-info">
                            <span class="version-badge" id="realtime-version-badge">v0</span>
                            <span class="version-name" id="realtime-version-name">Default</span>
                            <span class="version-date" id="realtime-version-date"></span>
                        </div>
                        <button class="btn-small btn-success" onclick="toggleVersionHistory('realtime')">
                            ğŸ“œ íˆìŠ¤í† ë¦¬ ë³´ê¸°
                        </button>
                    </div>

                    <div class="form-group">
                        <label for="realtime-instructions">System Instructions:</label>
                        <textarea id="realtime-instructions" class="prompt-editor"></textarea>
                        <div class="char-counter" id="realtime-instructions-counter">0ì</div>
                    </div>

                    <button class="btn-small" onclick="resetToDefault('realtime')">ğŸ”„ Defaultë¡œ ë˜ëŒë¦¬ê¸°</button>
                    <button class="btn-small btn-success" onclick="saveAsNewVersion('realtime')">ğŸ’¾ ìƒˆ ë²„ì „ìœ¼ë¡œ ì €ì¥</button>

                    <div class="version-history" id="realtime-version-history"></div>
                </div>

                <button class="btn" onclick="testPrompt('realtime')" id="realtime-test-btn">
                    <span>ğŸ” í† í° ë°œê¸‰í•˜ê¸°</span>
                    <span class="loading hidden" id="realtime-loading"></span>
                </button>

                <div class="response hidden" id="realtime-response"></div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // ì „ì—­ ë³€ìˆ˜ ë° ìƒìˆ˜
        // ============================================
        const API_BASE_URL = window.location.origin;
        const STORAGE_KEY = 'promptPlayground';
        
        // Default í”„ë¡¬í”„íŠ¸ (ë°±ì—”ë“œì™€ ë™ì¼í•˜ê²Œ ìœ ì§€)
        const DEFAULT_PROMPTS = {
            'organize-diary': `ë‹¹ì‹ ì€ ì¹œê·¼í•˜ê³  ë”°ëœ»í•œ ì¼ê¸° ì‘ì„± ë„ìš°ë¯¸ì…ë‹ˆë‹¤. 
ì‚¬ìš©ìê°€ ë§í•œ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ êµ¬ì¡°í™”ëœ ì¼ê¸° ìš”ì•½ì„ ìƒì„±í•´ì£¼ì„¸ìš”.

ê·œì¹™:
1. í•œêµ­ì–´ë¡œ ì‘ì„±í•˜ì„¸ìš”
2. 1ì¸ì¹­ ì‹œì ì„ ìœ ì§€í•˜ì„¸ìš” (ë‚˜ëŠ”, ë‚´ê°€ ë“±)
3. ê°ì •ê³¼ ëŠë‚Œì„ í’ë¶€í•˜ê²Œ í‘œí˜„í•˜ì„¸ìš”
4. ê° ì¹´í…Œê³ ë¦¬ì— í•´ë‹¹í•˜ëŠ” ë‚´ìš©ì´ ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´ë¡œ ë°˜í™˜í•˜ì„¸ìš”
5. ê° í•­ëª©ì€ ê°„ê²°í•˜ê²Œ 2-4ë‹¨ì–´ë¡œ í‘œí˜„í•˜ì„¸ìš”
6. oneLinerëŠ” ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ ëŒ€í‘œí•˜ëŠ” í•œ ë¬¸ì¥ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”
7. fullDiaryëŠ” ì „ì²´ ë‚´ìš©ì„ ìì—°ìŠ¤ëŸ½ê²Œ 3-5ë¬¸ì¥ìœ¼ë¡œ ì •ë¦¬í•˜ì„¸ìš”`,

            'context-extract': `ë‹¤ìŒ ëŒ€í™” ë‚´ìš©ì„ ë¶„ì„í•˜ì—¬ ì£¼ìš” ì»¨í…ìŠ¤íŠ¸ë¥¼ ì¶”ì¶œí•´ì£¼ì„¸ìš”:
1. ëŒ€í™”ì˜ ì£¼ìš” ì£¼ì œ
2. ì‚¬ìš©ìì˜ ì˜ë„ë‚˜ ëª©ì 
3. ì¤‘ìš”í•œ ì •ë³´ë‚˜ í‚¤ì›Œë“œ
4. ê°ì • ìƒíƒœë‚˜ í†¤
5. ëŒ€í™”ì˜ íë¦„ ìš”ì•½

ê²°ê³¼ëŠ” ê°„ê²°í•˜ê²Œ ë¶ˆë¦¿ í¬ì¸íŠ¸ í˜•ì‹ìœ¼ë¡œ ì •ë¦¬í•´ì£¼ì„¸ìš”.`,

            'tts': 'ì¹œê·¼í•˜ê³  ë°ì€ í†¤ìœ¼ë¡œ ë§í•´ì£¼ì„¸ìš”',

            'realtime': 'ë‹¹ì‹ ì€ ì¹œê·¼í•˜ê³  ë”°ëœ»í•œ ì¼ê¸° ì‘ì„± ë„ìš°ë¯¸ì…ë‹ˆë‹¤. ì‚¬ìš©ìì˜ í•˜ë£¨ ì´ì•¼ê¸°ë¥¼ ê²½ì²­í•˜ê³  ê³µê°í•˜ë©° ëŒ€í™”ë¥¼ ì´ì–´ê°€ì„¸ìš”. ìì—°ìŠ¤ëŸ½ê²Œ ì§ˆë¬¸í•˜ê³  ì‚¬ìš©ìê°€ ë” ë§ì€ ì´ì•¼ê¸°ë¥¼ í•  ìˆ˜ ìˆë„ë¡ ê²©ë ¤í•´ì£¼ì„¸ìš”.'
        };

        // ìƒ˜í”Œ ë°ì´í„°
        const SAMPLE_DATA = {
            'organize-diary': {
                1: "ì˜¤ëŠ˜ì€ ì•„ì¹¨ ì¼ì° ì¼ì–´ë‚˜ì„œ 30ë¶„ ì¡°ê¹…ì„ í–ˆì–´ìš”. ë‚ ì”¨ê°€ ë„ˆë¬´ ì¢‹ì•„ì„œ ê¸°ë¶„ì´ ìƒì¾Œí–ˆìŠµë‹ˆë‹¤. ì ì‹¬ì—ëŠ” íŒ€ íšŒì˜ê°€ ìˆì—ˆëŠ”ë° ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ ì•„ì´ë””ì–´ë¥¼ ë°œí‘œí–ˆì–´ìš”. ë™ë£Œë“¤ì´ ê¸ì •ì ìœ¼ë¡œ ë°˜ì‘í•´ì¤˜ì„œ ë¿Œë“¯í–ˆìŠµë‹ˆë‹¤. ì €ë…ì—ëŠ” ì¹œêµ¬ì™€ ë§›ìˆëŠ” ì €ë…ì„ ë¨¹ìœ¼ë©´ì„œ ì˜¤ëœë§Œì— ìˆ˜ë‹¤ë¥¼ ë–¨ì—ˆì–´ìš”. ì •ë§ ì•Œì°¬ í•˜ë£¨ì˜€ìŠµë‹ˆë‹¤.",
                2: "ì˜¤ëŠ˜ ë“œë””ì–´ ìš´ë™ì„ ì‹œì‘í–ˆë‹¤! í—¬ìŠ¤ì¥ì— ë“±ë¡í•˜ê³  PT ì²« ìˆ˜ì—…ì„ ë°›ì•˜ëŠ”ë° ìƒê°ë³´ë‹¤ í˜ë“¤ì—ˆë‹¤. í•˜ì§€ë§Œ íŠ¸ë ˆì´ë„ˆë‹˜ì´ ì¹œì ˆí•˜ê²Œ ê°€ë¥´ì³ì£¼ì…”ì„œ ì¢‹ì•˜ë‹¤. ìŠ¤ì¿¼íŠ¸ë‘ ë²¤ì¹˜í”„ë ˆìŠ¤ë¥¼ ë°°ì› ëŠ”ë° ìì„¸ê°€ ì •ë§ ì¤‘ìš”í•˜ë‹¤ëŠ” ê±¸ ì•Œì•˜ë‹¤. ì§‘ì— ì™€ì„œ ë‹¨ë°±ì§ˆ ì‰ì´í¬ë„ ë§Œë“¤ì–´ ë§ˆì…¨ë‹¤. 3ê°œì›” í›„ ëª©í‘œ ì²´ì¤‘ì„ ë‹¬ì„±í•˜ê³  ì‹¶ë‹¤. ë‚´ì¼ë„ ê¼­ ê°€ì•¼ì§€!",
                3: "ì˜¤ëŠ˜ ê¸°ë¶„ ì¢‹ì•˜ì–´ìš”! ë‚ ì”¨ë„ ì¢‹ê³  ì ì‹¬ë„ ë§›ìˆì—ˆì–´ìš”."
            }
        };

        // ============================================
        // LocalStorage ê´€ë¦¬ í•¨ìˆ˜
        // ============================================
        
        function initializeStorage() {
            const data = localStorage.getItem(STORAGE_KEY);
            if (!data) {
                const initialData = {
                    version: "1.0",
                    endpoints: {},
                    metadata: {
                        lastUpdated: Date.now(),
                        totalVersions: 0
                    }
                };
                
                // ê° ì—”ë“œí¬ì¸íŠ¸ì˜ v0 (Default) ìƒì„±
                for (const endpoint in DEFAULT_PROMPTS) {
                    initialData.endpoints[endpoint] = {
                        currentVersion: 'v0',
                        versions: [{
                            version: 'v0',
                            name: 'Default',
                            prompt: DEFAULT_PROMPTS[endpoint],
                            createdAt: Date.now(),
                            isDefault: true,
                            deletable: false
                        }]
                    };
                    initialData.metadata.totalVersions++;
                }
                
                localStorage.setItem(STORAGE_KEY, JSON.stringify(initialData));
                return initialData;
            }
            return JSON.parse(data);
        }

        function loadFromStorage() {
            return initializeStorage();
        }

        function saveToStorage(data) {
            try {
                data.metadata.lastUpdated = Date.now();
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                updateStorageUsage();
                return true;
            } catch (e) {
                if (e.name === 'QuotaExceededError') {
                    alert('âš ï¸ ì €ì¥ ê³µê°„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ì˜¤ë˜ëœ ë²„ì „ì„ ì‚­ì œí•´ì£¼ì„¸ìš”.');
                    return false;
                }
                throw e;
            }
        }

        function getVersions(endpoint) {
            const data = loadFromStorage();
            return data.endpoints[endpoint]?.versions || [];
        }

        function getCurrentVersion(endpoint) {
            const data = loadFromStorage();
            return data.endpoints[endpoint]?.currentVersion || 'v0';
        }

        function getCurrentVersionData(endpoint) {
            const versions = getVersions(endpoint);
            const currentVersion = getCurrentVersion(endpoint);
            return versions.find(v => v.version === currentVersion);
        }

        // ============================================
        // ë²„ì „ ê´€ë¦¬ í•¨ìˆ˜
        // ============================================

        function resetToDefault(endpoint) {
            if (!confirm('ì •ë§ Default ë²„ì „ìœ¼ë¡œ ë˜ëŒë¦¬ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            const versions = getVersions(endpoint);
            const defaultVersion = versions.find(v => v.version === 'v0');
            
            if (!defaultVersion) {
                alert('âŒ Default ë²„ì „ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // í”„ë¡¬í”„íŠ¸ ì—ë””í„°ì— í‘œì‹œ
            displayPrompt(endpoint, defaultVersion);
            
            // í˜„ì¬ ë²„ì „ì„ v0ë¡œ ì„¤ì •
            const data = loadFromStorage();
            data.endpoints[endpoint].currentVersion = 'v0';
            saveToStorage(data);
            
            // UI ì—…ë°ì´íŠ¸
            updateVersionHeader(endpoint);
            renderVersionHistory(endpoint);
            
            alert('âœ… Default ë²„ì „ìœ¼ë¡œ ë˜ëŒë ¸ìŠµë‹ˆë‹¤!');
        }

        function saveAsNewVersion(endpoint) {
            const currentPrompt = getPromptFromEditor(endpoint);
            
            if (!currentPrompt || currentPrompt.trim() === '') {
                alert('âŒ í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const versionName = prompt('ë²„ì „ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:', `ìˆ˜ì • ë²„ì „ ${new Date().toLocaleString('ko-KR')}`);
            
            if (!versionName) {
                return; // ì·¨ì†Œ
            }
            
            const data = loadFromStorage();
            const versions = data.endpoints[endpoint].versions;
            
            // ë²„ì „ ë²ˆí˜¸ ìë™ ì¦ê°€
            const latestVersion = versions[versions.length - 1].version;
            const newVersionNumber = parseInt(latestVersion.slice(1)) + 1;
            const newVersion = `v${newVersionNumber}`;
            
            // ìƒˆ ë²„ì „ ìƒì„±
            const newVersionObj = {
                version: newVersion,
                name: versionName,
                prompt: currentPrompt,
                createdAt: Date.now(),
                isDefault: false,
                deletable: true
            };
            
            versions.push(newVersionObj);
            data.endpoints[endpoint].currentVersion = newVersion;
            data.metadata.totalVersions++;
            
            if (saveToStorage(data)) {
                alert(`âœ… ${newVersion} ë²„ì „ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!`);
                updateVersionHeader(endpoint);
                renderVersionHistory(endpoint);
            }
        }

        function switchToVersion(endpoint, targetVersion) {
            const versions = getVersions(endpoint);
            const selectedVersion = versions.find(v => v.version === targetVersion);
            
            if (!selectedVersion) {
                alert('âŒ ë²„ì „ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // í˜„ì¬ ì—ë””í„° ë‚´ìš©ì´ ì €ì¥ ì•ˆ ë˜ì–´ ìˆìœ¼ë©´ ê²½ê³ 
            const currentPrompt = getPromptFromEditor(endpoint);
            const currentVersionObj = getCurrentVersionData(endpoint);
            
            if (currentPrompt !== currentVersionObj.prompt) {
                if (!confirm('í˜„ì¬ í¸ì§‘ ì¤‘ì¸ ë‚´ìš©ì´ ì €ì¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    return;
                }
            }
            
            // ì„ íƒí•œ ë²„ì „ìœ¼ë¡œ ì „í™˜
            displayPrompt(endpoint, selectedVersion);
            
            const data = loadFromStorage();
            data.endpoints[endpoint].currentVersion = targetVersion;
            saveToStorage(data);
            
            // UI ì—…ë°ì´íŠ¸
            updateVersionHeader(endpoint);
            renderVersionHistory(endpoint);
            
            alert(`âœ… ${targetVersion} ë²„ì „ìœ¼ë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤!`);
        }

        function deleteVersion(endpoint, versionToDelete) {
            // v0ì€ ì‚­ì œ ë¶ˆê°€
            if (versionToDelete === 'v0') {
                alert('âŒ Default ë²„ì „ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (!confirm(`ì •ë§ ${versionToDelete} ë²„ì „ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }
            
            const data = loadFromStorage();
            const currentVersion = data.endpoints[endpoint].currentVersion;
            
            // í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ ë²„ì „ ì‚­ì œ ì‹œ ê²½ê³ 
            if (versionToDelete === currentVersion) {
                alert('âŒ í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ ë²„ì „ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ë²„ì „ìœ¼ë¡œ ì „í™˜ í›„ ì‚­ì œí•˜ì„¸ìš”.');
                return;
            }
            
            // ë²„ì „ ì‚­ì œ
            data.endpoints[endpoint].versions = data.endpoints[endpoint].versions.filter(
                v => v.version !== versionToDelete
            );
            data.metadata.totalVersions--;
            
            saveToStorage(data);
            
            // UI ê°±ì‹ 
            renderVersionHistory(endpoint);
            
            alert(`âœ… ${versionToDelete} ë²„ì „ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!`);
        }

        // ============================================
        // UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        // ============================================

        function displayPrompt(endpoint, versionData) {
            const promptEditorId = getPromptEditorId(endpoint);
            const editor = document.getElementById(promptEditorId);
            if (editor) {
                editor.value = versionData.prompt;
                updateCharCounter(promptEditorId);
            }
        }

        function getPromptFromEditor(endpoint) {
            const promptEditorId = getPromptEditorId(endpoint);
            const editor = document.getElementById(promptEditorId);
            return editor ? editor.value : '';
        }

        function getPromptEditorId(endpoint) {
            const mapping = {
                'organize-diary': 'diary-prompt',
                'context-extract': 'context-prompt',
                'tts': 'tts-instructions',
                'realtime': 'realtime-instructions'
            };
            return mapping[endpoint];
        }

        function updateVersionHeader(endpoint) {
            const versionData = getCurrentVersionData(endpoint);
            if (!versionData) return;
            
            const prefix = endpoint.replace('-', '');
            const badge = document.getElementById(`${getShortEndpoint(endpoint)}-version-badge`);
            const name = document.getElementById(`${getShortEndpoint(endpoint)}-version-name`);
            const date = document.getElementById(`${getShortEndpoint(endpoint)}-version-date`);
            
            if (badge) {
                badge.textContent = versionData.version;
                badge.className = versionData.isDefault ? 'version-badge default' : 'version-badge';
            }
            if (name) name.textContent = versionData.name;
            if (date && !versionData.isDefault) {
                date.textContent = new Date(versionData.createdAt).toLocaleString('ko-KR');
            }
        }

        function getShortEndpoint(endpoint) {
            const mapping = {
                'organize-diary': 'diary',
                'context-extract': 'context',
                'tts': 'tts',
                'realtime': 'realtime'
            };
            return mapping[endpoint];
        }

        function toggleVersionHistory(endpoint) {
            const historyId = `${getShortEndpoint(endpoint)}-version-history`;
            const history = document.getElementById(historyId);
            
            if (history.classList.contains('show')) {
                history.classList.remove('show');
            } else {
                renderVersionHistory(endpoint);
                history.classList.add('show');
            }
        }

        function renderVersionHistory(endpoint) {
            const historyId = `${getShortEndpoint(endpoint)}-version-history`;
            const history = document.getElementById(historyId);
            if (!history) return;
            
            const versions = getVersions(endpoint);
            const currentVersion = getCurrentVersion(endpoint);
            
            let html = '<h4>ğŸ“œ ë²„ì „ íˆìŠ¤í† ë¦¬</h4>';
            
            // ìµœì‹  ë²„ì „ë¶€í„° í‘œì‹œ (ì—­ìˆœ)
            for (let i = versions.length - 1; i >= 0; i--) {
                const v = versions[i];
                const isCurrent = v.version === currentVersion;
                const itemClass = isCurrent ? 'version-item current' : 
                                 (v.isDefault ? 'version-item default-version' : 'version-item');
                
                html += `
                    <div class="${itemClass}">
                        <div class="version-item-header">
                            <div class="version-item-info">
                                <span class="version-badge ${v.isDefault ? 'default' : ''}">${v.version}</span>
                                <span class="version-name">${v.isDefault ? 'ğŸ”’ ' : ''}${v.name}</span>
                                ${isCurrent ? '<span class="version-status">âœ… í˜„ì¬ ë²„ì „</span>' : ''}
                            </div>
                        </div>
                        <div class="version-meta">
                            <small>${v.isDefault ? 'ì‹œìŠ¤í…œ ê¸°ë³¸ í”„ë¡¬í”„íŠ¸' : new Date(v.createdAt).toLocaleString('ko-KR')}</small>
                        </div>
                        <div class="version-actions">
                            ${isCurrent ? 
                                '<button class="btn-small" disabled>ì´ ë²„ì „ ë³´ê¸°</button>' : 
                                `<button class="btn-small" onclick="switchToVersion('${endpoint}', '${v.version}')">ì´ ë²„ì „ìœ¼ë¡œ ì „í™˜</button>`
                            }
                            ${v.deletable ? 
                                `<button class="btn-small btn-danger" onclick="deleteVersion('${endpoint}', '${v.version}')">ì‚­ì œ</button>` :
                                '<button class="btn-small" disabled title="Default ë²„ì „ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤">ì‚­ì œ ë¶ˆê°€</button>'
                            }
                        </div>
                    </div>
                `;
            }
            
            history.innerHTML = html;
        }

        // ============================================
        // íƒ­ ì „í™˜
        // ============================================

        function switchTab(tabName) {
            // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // ì„ íƒí•œ íƒ­ í™œì„±í™”
            event.target.classList.add('active');
            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            // í•´ë‹¹ íƒ­ì˜ í”„ë¡¬í”„íŠ¸ ë¡œë“œ
            loadPromptForTab(tabName);
        }

        function loadPromptForTab(endpoint) {
            const versionData = getCurrentVersionData(endpoint);
            if (versionData) {
                displayPrompt(endpoint, versionData);
                updateVersionHeader(endpoint);
            }
        }

        // ============================================
        // ìƒ˜í”Œ ë°ì´í„° ë° ì…ë ¥ ê´€ë¦¬
        // ============================================

        function loadSample(endpoint, sampleNum) {
            const inputId = `${getShortEndpoint(endpoint)}-input`;
            const input = document.getElementById(inputId);
            if (input && SAMPLE_DATA[endpoint] && SAMPLE_DATA[endpoint][sampleNum]) {
                input.value = SAMPLE_DATA[endpoint][sampleNum];
                updateCharCounter(inputId);
            }
        }

        function clearInput(endpoint) {
            const inputId = `${getShortEndpoint(endpoint)}-input`;
            const input = document.getElementById(inputId);
            if (input) {
                input.value = '';
                updateCharCounter(inputId);
            }
        }

        function updateCharCounter(elementId) {
            const element = document.getElementById(elementId);
            const counter = document.getElementById(`${elementId}-counter`);
            if (element && counter) {
                counter.textContent = `${element.value.length}ì`;
            }
        }

        // ============================================
        // API í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
        // ============================================

        async function testPrompt(endpoint) {
            const inputId = `${getShortEndpoint(endpoint)}-input`;
            const loadingId = `${getShortEndpoint(endpoint)}-loading`;
            const responseId = `${getShortEndpoint(endpoint)}-response`;
            const btnId = `${getShortEndpoint(endpoint)}-test-btn`;
            
            const input = document.getElementById(inputId);
            const loading = document.getElementById(loadingId);
            const response = document.getElementById(responseId);
            const btn = document.getElementById(btnId);
            
            // ì…ë ¥ ê²€ì¦
            if (endpoint !== 'realtime' && (!input || !input.value.trim())) {
                alert('í…ŒìŠ¤íŠ¸ ì…ë ¥ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ë¡œë”© ì‹œì‘
            if (loading) loading.classList.remove('hidden');
            if (response) response.classList.add('hidden');
            if (btn) btn.disabled = true;
            
            try {
                const currentPrompt = getPromptFromEditor(endpoint);
                
                let result;
                switch (endpoint) {
                    case 'organize-diary':
                        result = await testOrganizeDiary(input.value, currentPrompt);
                        break;
                    case 'context-extract':
                        result = await testContextExtract(input.value, currentPrompt);
                        break;
                    case 'tts':
                        result = await testTTS(input.value, currentPrompt);
                        break;
                    case 'realtime':
                        result = await testRealtime(currentPrompt);
                        break;
                }
                
                displayResponse(responseId, result);
                
            } catch (error) {
                displayError(responseId, error);
            } finally {
                if (loading) loading.classList.add('hidden');
                if (btn) btn.disabled = false;
            }
        }

        async function testOrganizeDiary(text, customPrompt) {
            const startTime = Date.now();
            const response = await fetch(`${API_BASE_URL}/api/organize-diary`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text, customPrompt })
            });
            
            const data = await response.json();
            const elapsed = ((Date.now() - startTime) / 1000).toFixed(2);
            
            if (!response.ok) throw new Error(data.error || 'API í˜¸ì¶œ ì‹¤íŒ¨');
            
            return { type: 'organize-diary', data, elapsed };
        }

        async function testContextExtract(conversationText, customPrompt) {
            const startTime = Date.now();
            const response = await fetch(`${API_BASE_URL}/api/context/extract`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ conversationText, customPrompt })
            });
            
            const data = await response.json();
            const elapsed = ((Date.now() - startTime) / 1000).toFixed(2);
            
            if (!response.ok) throw new Error(data.error || 'API í˜¸ì¶œ ì‹¤íŒ¨');
            
            return { type: 'context-extract', data, elapsed };
        }

        async function testTTS(text, instructions) {
            const voice = document.getElementById('tts-voice').value;
            const startTime = Date.now();
            
            const response = await fetch(`${API_BASE_URL}/api/audio/speech`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text, voice, instructions })
            });
            
            const elapsed = ((Date.now() - startTime) / 1000).toFixed(2);
            
            if (response.ok && response.headers.get('content-type')?.includes('audio')) {
                const audioBlob = await response.blob();
                const audioUrl = URL.createObjectURL(audioBlob);
                return { type: 'tts', audioUrl, elapsed, voice, textLength: text.length };
            } else {
                const data = await response.json();
                throw new Error(data.error || 'TTS ìƒì„± ì‹¤íŒ¨');
            }
        }

        async function testRealtime(instructions) {
            const model = document.getElementById('realtime-model').value;
            const voice = document.getElementById('realtime-voice').value;
            const startTime = Date.now();
            
            const response = await fetch(`${API_BASE_URL}/api/realtime/token`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    userId: 'playground_test_user',
                    sessionConfig: { model, voice, instructions }
                })
            });
            
            const data = await response.json();
            const elapsed = ((Date.now() - startTime) / 1000).toFixed(2);
            
            if (!response.ok) throw new Error(data.error || 'Token ë°œê¸‰ ì‹¤íŒ¨');
            
            return { type: 'realtime', data, elapsed };
        }

        // ============================================
        // ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜
        // ============================================

        function displayResponse(responseId, result) {
            const response = document.getElementById(responseId);
            if (!response) return;
            
            response.classList.remove('hidden', 'error');
            response.classList.add('success');
            
            let html = '<h4>âœ… í…ŒìŠ¤íŠ¸ ì„±ê³µ!</h4>';
            
            switch (result.type) {
                case 'organize-diary':
                    html += `
                        <div class="result-section">
                            <strong>ğŸ’¬ ì˜¤ëŠ˜ì˜ í•œì¤„</strong>
                            <p>${result.data.summary.oneLiner}</p>
                        </div>
                        <div class="result-section">
                            <strong>ğŸ“Œ ì£¼ìš” ì¼ìƒ</strong>
                            <ul>${result.data.summary.dailyHighlights.length > 0 ? 
                                result.data.summary.dailyHighlights.map(h => `<li>${h}</li>`).join('') : 
                                '<li style="opacity: 0.6;">ì—†ìŒ</li>'}</ul>
                        </div>
                        <div class="result-section">
                            <strong>ğŸ¯ ëª©í‘œ ì¶”ì </strong>
                            <ul>${result.data.summary.goalTracking.length > 0 ? 
                                result.data.summary.goalTracking.map(g => `<li>${g}</li>`).join('') : 
                                '<li style="opacity: 0.6;">ì—†ìŒ</li>'}</ul>
                        </div>
                        <div class="result-section">
                            <strong>ğŸ™ ê°ì‚¬í•œ ì¼</strong>
                            <ul>${result.data.summary.gratitude.length > 0 ? 
                                result.data.summary.gratitude.map(g => `<li>${g}</li>`).join('') : 
                                '<li style="opacity: 0.6;">ì—†ìŒ</li>'}</ul>
                        </div>
                        <div class="result-section">
                            <strong>ğŸ˜Š ì£¼ìš” ê°ì •</strong>
                            <ul>${result.data.summary.emotions.length > 0 ? 
                                result.data.summary.emotions.map(e => `<li>${e}</li>`).join('') : 
                                '<li style="opacity: 0.6;">ì—†ìŒ</li>'}</ul>
                        </div>
                        <div class="result-section">
                            <strong>ğŸ“– ì „ì²´ ì¼ê¸°</strong>
                            <p>${result.data.summary.fullDiary}</p>
                        </div>
                        <div class="meta-info">
                            <small>
                                ì›ë³¸ ê¸¸ì´: ${result.data.originalTextLength}ì | 
                                ì‚¬ìš© í† í°: ${result.data.tokensUsed} | 
                                í”„ë¡¬í”„íŠ¸: ${result.data._meta.promptUsed} |
                                ì‘ë‹µ ì‹œê°„: ${result.elapsed}ì´ˆ
                            </small>
                        </div>
                    `;
                    break;
                    
                case 'context-extract':
                    html += `
                        <div class="result-section">
                            <strong>ğŸ§  ì¶”ì¶œëœ ì»¨í…ìŠ¤íŠ¸</strong>
                            <p style="line-height: 1.8; white-space: pre-wrap;">${result.data.context}</p>
                        </div>
                        <div class="meta-info">
                            <small>
                                ëŒ€í™” ê¸¸ì´: ${result.data.conversationLength}ì | 
                                ì‚¬ìš© í† í°: ${result.data.tokensUsed} | 
                                ì‘ë‹µ ì‹œê°„: ${result.elapsed}ì´ˆ
                            </small>
                        </div>
                    `;
                    break;
                    
                case 'tts':
                    html += `
                        <div class="result-section">
                            <strong>ğŸ”Š ìƒì„±ëœ ìŒì„±</strong>
                            <audio controls style="width: 100%; margin-top: 10px;">
                                <source src="${result.audioUrl}" type="audio/mpeg">
                                Your browser does not support the audio element.
                            </audio>
                        </div>
                        <div class="meta-info">
                            <small>
                                ìŒì„±: ${result.voice} | 
                                í…ìŠ¤íŠ¸ ê¸¸ì´: ${result.textLength}ì | 
                                ì‘ë‹µ ì‹œê°„: ${result.elapsed}ì´ˆ
                            </small>
                        </div>
                    `;
                    break;
                    
                case 'realtime':
                    const expiresIn = Math.floor((result.data.expiresAt - Date.now() / 1000) / 60);
                    const expiresAtDate = new Date(result.data.expiresAt * 1000);
                    
                    html += `
                        <div class="result-section">
                            <strong>ğŸ”‘ Token (í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì‚¬ìš©)</strong>
                            <p style="word-break: break-all; font-family: 'Courier New', monospace; background: rgba(0,0,0,0.05); padding: 12px; border-radius: 5px; border: 1px solid #ddd;">
                                ${result.data.token}
                            </p>
                            <button class="btn-small" onclick="copyToClipboard('${result.data.token}', this)">
                                ğŸ“‹ í† í° ë³µì‚¬
                            </button>
                        </div>
                        <div class="result-section">
                            <strong>ğŸ†” ì„¸ì…˜ ID</strong>
                            <p style="font-family: monospace;">${result.data.sessionId}</p>
                        </div>
                        <div class="result-section">
                            <strong>â° ë§Œë£Œ ì‹œê°„</strong>
                            <p>ğŸ“… ${expiresAtDate.toLocaleString('ko-KR')}</p>
                            <p style="color: ${expiresIn < 5 ? '#d32f2f' : '#1976d2'}; font-weight: bold;">
                                â±ï¸ ì•½ ${expiresIn}ë¶„ í›„ ë§Œë£Œ
                            </p>
                        </div>
                        <div class="result-section">
                            <strong>âš™ï¸ ì„¸ì…˜ ì„¤ì •</strong>
                            <p><strong>ëª¨ë¸:</strong> ${result.data.config.model}</p>
                            <p><strong>ìŒì„±:</strong> ${result.data.config.voice}</p>
                        </div>
                        <div class="meta-info">
                            <small>ì‘ë‹µ ì‹œê°„: ${result.elapsed}ì´ˆ</small>
                        </div>
                    `;
                    break;
            }
            
            response.innerHTML = html;
        }

        function displayError(responseId, error) {
            const response = document.getElementById(responseId);
            if (!response) return;
            
            response.classList.remove('hidden', 'success');
            response.classList.add('error');
            response.innerHTML = `
                <h4>âŒ ì˜¤ë¥˜ ë°œìƒ</h4>
                <p><strong>ì—ëŸ¬ ë©”ì‹œì§€:</strong> ${error.message}</p>
                <pre style="margin-top: 15px; font-size: 0.85rem;">${error.stack || ''}</pre>
            `;
        }

        // ============================================
        // Export/Import í•¨ìˆ˜
        // ============================================

        function exportAllVersions() {
            const data = loadFromStorage();
            const json = JSON.stringify(data, null, 2);
            
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `prompt-playground-backup-${Date.now()}.json`;
            a.click();
            
            // ë§ˆì§€ë§‰ ë°±ì—… ì‹œê°„ ì €ì¥
            data.metadata.lastBackup = Date.now();
            saveToStorage(data);
            
            alert('âœ… ëª¨ë“  ë²„ì „ì„ íŒŒì¼ë¡œ ì €ì¥í–ˆìŠµë‹ˆë‹¤!');
        }

        function importVersions(file) {
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // ê¸°ì¡´ ë°ì´í„° í™•ì¸
                    const existingData = localStorage.getItem(STORAGE_KEY);
                    
                    if (existingData) {
                        if (confirm('ê¸°ì¡´ ë°ì´í„°ê°€ ìˆìŠµë‹ˆë‹¤. ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?\n(ì·¨ì†Œí•˜ë©´ ë³‘í•©ë©ë‹ˆë‹¤)')) {
                            // ë®ì–´ì“°ê¸°
                            localStorage.setItem(STORAGE_KEY, e.target.result);
                        } else {
                            // ë³‘í•© (ê°„ë‹¨í•œ ë²„ì „: import ìš°ì„ )
                            const existing = JSON.parse(existingData);
                            const merged = { ...existing, ...importedData };
                            localStorage.setItem(STORAGE_KEY, JSON.stringify(merged));
                        }
                    } else {
                        localStorage.setItem(STORAGE_KEY, e.target.result);
                    }
                    
                    alert('âœ… ë²„ì „ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤! í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.');
                    location.reload();
                    
                } catch (error) {
                    alert('âŒ íŒŒì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function updateStorageUsage() {
            const data = localStorage.getItem(STORAGE_KEY) || '';
            const bytes = new Blob([data]).size;
            const mb = (bytes / 1024 / 1024).toFixed(2);
            const usageEl = document.getElementById('storage-usage');
            if (usageEl) {
                usageEl.textContent = `ğŸ’¾ ì‚¬ìš© ì¤‘: ${mb} MB / 5 MB`;
            }
        }

        // ============================================
        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
        // ============================================

        function copyToClipboard(text, buttonElement) {
            navigator.clipboard.writeText(text).then(() => {
                const originalText = buttonElement.textContent;
                buttonElement.textContent = 'âœ… ë³µì‚¬ë¨!';
                buttonElement.style.background = '#28a745';
                
                setTimeout(() => {
                    buttonElement.textContent = originalText;
                    buttonElement.style.background = '';
                }, 2000);
            }).catch(err => {
                alert('ë³µì‚¬ ì‹¤íŒ¨: ' + err.message);
            });
        }

        // ============================================
        // ì´ˆê¸°í™”
        // ============================================

        document.addEventListener('DOMContentLoaded', () => {
            // LocalStorage ì´ˆê¸°í™”
            initializeStorage();
            
            // ì²« ë²ˆì§¸ íƒ­ ë¡œë“œ
            loadPromptForTab('organize-diary');
            
            // ëª¨ë“  ìºë¦­í„° ì¹´ìš´í„° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            const textareas = document.querySelectorAll('textarea');
            textareas.forEach(textarea => {
                textarea.addEventListener('input', () => {
                    updateCharCounter(textarea.id);
                });
                updateCharCounter(textarea.id);
            });
            
            // ì €ì¥ ê³µê°„ ì‚¬ìš©ëŸ‰ í‘œì‹œ
            updateStorageUsage();
            
            console.log('âœ… í”„ë¡¬í”„íŠ¸ í”Œë ˆì´ê·¸ë¼ìš´ë“œ ì´ˆê¸°í™” ì™„ë£Œ!');
        });
    </script>
</body>
</html>
